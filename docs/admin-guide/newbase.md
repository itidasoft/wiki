---
title: Алгоритм формирования новой базы данных
description: Руководство администратора
published: true
date: 2022-08-03T20:57:25.561Z
tags: новая база, свертка базы, перенос данных
editor: markdown
dateCreated: 2022-08-03T20:57:23.101Z
---

Предлагаемый алгоритм формирования новой базы данных Айтида предназначен для автоматизации процесса создания базы данных Айтида, используя накопленные данные в существующей рабочей базе данных.

Новая база данных создается из чистой дистрибутивной базы данных, в которую последовательно переносится информация из справочников, документов и служебных таблиц существующей базы. При этом:

Системные настройки переносятся целиком.

Справочники переносятся целиком.

Документы переносятся только с указанной даты.

Кассовые транзакции переносятся с указанной даты.

На входящие остатки формируются выбранные документы.

В новой базе формируются документы, их проведение сформирует необходимые начальные остатки. В итоге, пользователь получает возможность в процессе переноса данных провести ревизию и сформировать входящие остатки требуемым образом.

# Настройка алгоритма загрузки

1.  Загрузить актуальные файлы по [ссылке](http://itida.ru/download/profiles/newbase_algorithm.rar).
2.  Файл Алгоритмы.CNT необходимо загрузить в **«Сервис/Настройка системы/Справочник алгоритмов выполнения»**.
3.  Файл ПараметрыАлгоритмаформированияНовойБазы.CNT необходимо загрузить в **«Сервис/Настройка системы/Настройка параметров системы».**
4.  Файл ФУНКЦИЯАЛГОРИТМАФОРМИРОВАНИЯНОВОЙБАЗЫ.CNT необходимо загрузить в **«Сервис/Настройка системы/Функции пользователей».**

    Загрузка файлов в указанные справочники производится одинаково. Для этого необходимо нажать кнопку Обмен, в левом нижнем углу формы справочника, в появившемся окне выбрать загружаемый файл и нажать кнопку «Загрузить в базу данных».

![Изображение выглядит как текст, стол Автоматически созданное описание](/images/admin-guide/newbase/aa6bbd8217f24026672ea6876fb95aa8.png)

Если по какой либо причине, **«Справочника алгоритмов работы»** нет в меню системы, то его можно туда добавить использовав команду **DO spralgorithm.**

![Изображение выглядит как текст Автоматически созданное описание](/images/admin-guide/newbase/71fbc143d7e78fe7b673ffb3dff7d057.png)

# Выполнение алгоритма загрузки

Перед запуском алгоритма, необходимо создать пустую базу данных, с помощью программы IRestoreDB.exe, использовав в качестве шаблона одну из баз, поставляемых с дистрибутивом системы (например, **ItidaRetail**). Необходимо, чтобы версия пустой базы соответствовала версии рабочей базы. Иначе, из-за различий в структуре не все данные смогут быть перенесены в новую базу данных.

Для выполнения алгоритма необходимо в **«Справочнике алгоритмов работы»** нажать правую кнопку мыши на строке **«Формирование новой базы»** и выбрать пункт **«Выполнить»**.

![Изображение выглядит как стол Автоматически созданное описание](/images/admin-guide/newbase/6d55af8e189c1f947eb2eb482fa0513d.png)

В появившемся окне необходимо определить параметры алгоритма. 
![Изображение выглядит как текст Автоматически созданное описание](/images/admin-guide/newbase/081876a6dffe16816dc117ff4e469678.png)

**Выберите Рабочую базу данных —** необходимо выбрать базу данных, из которой будет производиться выгрузка данных и расчет начальных остатков. Эта база может не совпадать с той, к которой в данный момент подключена Айтида.

**Выберите Новую базу данных —** необходимо выбрать базу данных, в которую будут выгружены данные, и в которой будут сформированы остатки.

**Дата переноса документов —** необходимо указать дату, начиная с которой (включительно) документы будут перенесены в новую базу. Входящие остатки в новой базе данных будут сформированы на начало указанного дня.

**Переносить калькуляции —** если в Айтиде ведется учет производимой продукции и присутствуют Калькуляции товаров, то есть возможность указать, какие из калькуляций необходимо перенести в новую базу данных. В отличии от прочих документов, калькуляции необходимо переносить не по их дате, а по их актуальности.

**Дата переноса кассовых транзакций —** необходимо указать, начиная с какой даты (включительно) необходимо переносить сохраненные кассовые транзакции в новую базу данных.

**Формировать остатки ТМЦ —** позволяет выбрать, каким документом необходимо сформировать начальные остатки ТМЦ в новой базе. Доступные варианты: **Приходная накладная, Инвентаризация ТМЦ**.

> **Внимание!** *Независимо от выбранного типа документов остатки будут сформированы* **в разрезе складов** *и* **МОЛ** *рабочей базы данных*.
{.is-warning}


# Шаги алгоритма

Алгоритм формирования новой базы состоит из 11 шагов.

![Изображение выглядит как текст Автоматически созданное описание](/images/admin-guide/newbase/87d0439f409a227170e9133d68151b7f.png)

**Шаг 1. Выбор баз данных.** Предлагается ввести необходимые параметры алгоритма и осуществляется их проверка. Проверяются имена выбранных баз данных.

> **Внимание!** *Нельзя переносить данные в текущую базу, к которой подключена Айтида. Нельзя переносить данные из* «*Рабочей базы*» *в нее же. Нельзя переносить данные в базу другой версии.*
{.is-warning}


**Шаг 2. Перенос справочников.** На этом шаге осуществляется перенос информации из всех справочников из «Рабочей базы» в «Новую базу». Переносятся все карточки справочников. Так же переносится вся связанная с карточками информация, например, комплектация товаров, дополнительные единицы измерения и т.п.

**Шаг 3. Перенос документов.** Переносятся все типы документов из «Рабочей базы» в «Новую базу», начиная с указанной даты. Отдельно обрабатывается документ «Калькуляция ТМЦ». В зависимости от выбора, переносятся либо все калькуляции, либо только действующие. Так же переносятся все связанные с документами таблицы – списки учетов, спецификации, серийные номера, номера партий, связи между документами.

> **Примечание!** *Документы переносятся не проведенными по регистрам учета.*
{.is-success}


**Шаг 4.** **Перенос системных настроек.** На этом шаге переносятся все системные настройки – параметры системы, параметры пользователей, настройки документов и справочников.

**Шаг 5.** **Начальные остатки по товарам.** На этом шаге производится расчет остатков товаров, остатков номеров партий, остатков серийных номеров и цены реализации. Расчет остатков проводится в разрезе складов и МОЛ. По каждому складу и МОЛ формируется отдельный документ – «Приходная накладная» или «Инвентаризация ТМЦ», в зависимости от выбора в параметрах алгоритма. Для формирования в «Новой базе» цен реализации для каждой категории цены создаются документы «Переоценки», содержащие рассчитанные на указанную дату цены.

> **Внимание!** *Следует иметь в виду, что учет партий товаров производится не в разрезе складов, поэтому начальные остатки по номерам партий записываются в первый созданный документ.*
{.is-warning}


**Шаг 6. Начальные остатки по денежным средствам.** На этом шаге производится расчет остатков денежных средств в разрезе денежных карманов и валют. Для наличных денежных карманов создаются приходные кассовые ордера; для безналичных – выписки из банка; проведение которых создаст необходимые остатки в денежных карманах.

**Шаг 7. Начальные остатки по взаиморасчетам с контрагентами.** На этом шаге производится расчет остатков по взаиморасчетам с контрагентами. Расчет производится в разрезе контрагентов, договоров с контрагентами и валюты взаиморасчетов. Для формирования остатка формируются документы «Аванс полученный».

**Шаг 8.** **Начальные остатки по резервам товаров.** На этом шаге рассчитываются остатки по регистру учета резервов ТМЦ. Формируются документы: «Резервирование ТМЦ» для отражения остатков по резервам для внутренних складов; «Заказ от покупателя» для резервов, сформированных для конкретных контрагентов.

**Шаг 9. Начальные остатки по взаиморасчетам с сотрудниками.** На этом шаге рассчитываются остатки по регистру учета взаиморасчетов с сотрудниками (reg011) и для каждого сотрудника с незакрытым взаиморасчетом создается отдельный документ «Авансовый отчет» с суммой взаиморасчета.

**Шаг 10.**  **Начальные остатки по заказам поставщикам.**  На этом шаге рассчитываются остатки по регистру учета заказов поставщикам. Формируются документы «Заказ поставщику», в которых указаны количества заказанных товаров.

**Шаг 11.**  **Перенос кассовых транзакций.**  На этом шаге переносятся кассовые транзакции начиная с указанной даты (включительно) из «Рабочей базы» в «Новую базу». Обороты по дисконтным картам хранятся в отдельной таблице и переносятся вместе со справочником дисконтных карт целиком.

# Другие стандартные алгоритмы.

Кроме рассмотренного алгоритма формирования новой базы, в базово поставке есть следующие алгоритмы, позволяющие выполнять различные действия с накопленными данными.

1.  Копирование документов из базы в базу. Данный алгоритм позволяет перенести документы из одной базы данных в другу. Алгоритм предполагает, что база данных, в которую производится загрузка данных является более ранней копией базы из которой производится передача данных.
2.  Формирование новой базы без входящих остатков. Алгоритм позволяет создать новую базу данных на основе существующей без переноса документов и остатков.
3.  Пример копирования товаров, остатков и калькуляций из одной базы в другую. Алгоритм представляет собой пример, позволяющий перенести из одной базы в другую справочник товаров, остатки по ним и калькуляции.

    Загрузка справочника товаров из 1С XML. Алгоритм позволяет загрузить справочник товаров из 1С, выгруженный стандартной выгрузкой 1С.
