---
title: iMark
description: Сервис для работы с маркированной и алкогольной продукцией
published: true
date: 2024-10-28T14:17:35.437Z
tags: маркировка, imark, проверка маркировки, сроки годности, статусы км
editor: markdown
dateCreated: 2023-12-04T17:38:33.872Z
---

# Введение

С 1 апреля 2024 года поэтапно вводится режим проверок на кассах для товаров, подлежащих маркировке для следующих категорий: табак, пиво, молочная продукция, упакованная вода, антисептики, БАД, обувь, фотоаппараты, шины, одежда, духи и безалкогольные напитки.  
С этой даты поэтапно наступает запрет продажи товара, подлежащего обязательной маркировке, если при проверке кода маркировки на кассе кассовое ПО выдало ошибку. Изменения будут направлены на улучшение контроля за товарооборотом на рынке, усиление борьбы с контрафактной продукцией и повышение защиты прав потребителей.

Более подробной информацией по разрешительному режиму можно ознакомиться на сайте: <https://markirovka.ru/community/rezhim-proverok-na-kassakh/rezhim-proverok-na-kassakh>

# Что такое Айтида iMark?

Айтида iMark – это программный модуль, подключаемый к популярным кассовым решениям и обеспечивающий взаимодействие с ГИС МТ в части работы с разрешительным режимом согласно всем необходимым для этого требованиям.

Среди функциональных возможностей модуля присутствуют:

\- **Открытый API для интеграции**. Это позволяет подключить и использовать модуль совместно с любым кассовым решением.

\- **Возможность работы с несколькими юридическими лицами** для разделения проверок по своим токенам для каждого юридического лица,

\- **Работа с собственной базой данных** SQL Lite и MS SQL Server, а также автоматическое пополнение базы проданных кодов маркировки для последующего исключения повторных продаж без необходимости отправки запроса проверки в ГИС МТ

\- **Автоматическое резервное копирование** базы данных с заданным интервалом для повышения уровня надежности.

\- **Автоматическая фоновая работа с CDN**: получение списка, проверка доступности, расчет скорости отклика, актуализация и переключение между CDN для наиболее быстрого получения результата проверки. Полное соответствие требованиям к поведению ПО в случае аварийных ситуаций, описанных в методических рекомендациях Честного знака в пункте «1.4.3. Переключение между CDN-площадками», доступно начиная с релиза 1.02.

\- **Разграничение прав доступа** пользователей по ролям. Это позволит выдавать ограниченный доступ к API и обезопасить систему от необдуманных действий сотрудников.

\- **Удобный клиент для управления** и настройки сервера iMark. Варианты взаимодействия с сервером: 1) API; 2) Приложение для Windows; 3) Веб интерфейс.

\- **Ведение журнала** клиентских вызовов и журнала взаимодействия с ГИС МТ для обеспечения наличия технической информации и выполнении требования ППР №1944 в случае сбойных ситуаций (отсутствие интернета, сбой со стороны ГИС МТ…)

\- **Автоматическое обновление** встроенных модулей взаимодействия с ГИС МТ. В случае изменения алгоритмов взаимодействия с ГИС МТ, не требующих изменений в ядре службы, не потребуется вручную обновлять файлы службы. Все изменения загрузятся в модуль iMark автоматически с нашего сервера.

# Быстрый старт

С процессом подготовки Айтида РМК к разрешительному режиму, а так же с настройкой и установкой модуля iMark можно ознакомиться [в обучающем видео](https://rutube.ru/video/cf68a1f49e7a3caaf2ce604939b6f5f1/).

[![](https://markdown-videos-api.jorgenkh.no/youtube/rORDJPWxTc8)](https://rutube.ru/video/cf68a1f49e7a3caaf2ce604939b6f5f1/)

# Установка и настройка модуля Айтида iMark.

## Скачивание и установка

Скачать актуальную версию модуля можно по ссылке: <https://itida.ru/itida-imark>.

Модуль поставляется в виде отдельных файлов в архиве.

![Список файлов в составе iMark](/images/imark/927d1e9958ee5076946cc8ec4049831f.png){.align-center}

Для установки требуется распаковать файлы архива в один каталог на жестком диске и запустить утилиту **imarkinstall.exe**. При запуске, если рядом с утилитой будет обнаружен главный файл службы **imarksrv.exe**, то он автоматически пропишется в поле «Имя исполняемого файла службы»

![Изображение выглядит как текст, снимок экрана, программное обеспечение, веб-страница Автоматически созданное описание](/images/imark/dc975ab7dee926b46984187b6d87df08.png){.align-center}

В поле «Порт» необходимо указать порт службы, на котором будут приниматься запросы от клиентов (кассового программного обеспечения). По умолчанию этот порт устанавливается в значение 8000.

Для установки одной службы достаточно нажать кнопку «Установить службу» и после получения сообщения об успешной установке нажать «Запустить службу».

![Изображение выглядит как текст, снимок экрана, программное обеспечение, веб-страница Автоматически созданное описание](/images/imark/1bb1e4c549f114be763da5f2a398f2d8.png){.align-center}

При запуске службы, если она устанавливается первый раз, будет автоматически создана база SQL Lite в каталоге службы и с именем равным имени службы.

![База данных SQL Lite](/images/imark/0d0291d9e5271838604cd29b5360f051.png){.align-center}

Для переключения на другой тип базы данных, а также для изменения прочих настроек необходимо воспользоваться клиентом, запустив **imarkcln.exe**.

## Начальная настройка

![Изображение выглядит как текст, снимок экрана, Шрифт, Операционная система Автоматически созданное описание](/images/imark/b3fa367f29c1ca9ec8ea504679503488.png){.align-center}

При запуске будут запрошены уникальный пароль пользователя, а также IP адрес и порт сервера, к которому требуется подключиться для настройки.

По умолчанию в базе данных присутствует пользователь Администратор с правом настроек и паролем **123**, а также пользователь Касса с паролем **1**.

Авторизовавшись под пользователем с правом настроек, откроется главная страница приложения с функционалом проверки кодов маркировки.

![Изображение выглядит как текст, снимок экрана, программное обеспечение, компьютер Автоматически созданное описание](/images/imark/85a7e6b8c667b81e7ac0368db29a4780.png){.align-center}

>   Перед установкой настроек следует определиться с какой базой данных будет производиться работа. Если требуется переключиться на MS SQL сервер, то это требуется произвести до того, как будут заданы первые настройки через клиент, т. к. при переключении типа базы, если такая база отсутствует, будет создана новая база данных с настройками по умолчанию.
{.is-warning}


Для перехода к настройкам необходимо переключиться на вкладку «Настройки» и в разделе «Справочники» у созданной по умолчанию организации указать:

\- наименование,

\- токен доступа в ГИС МТ (полученный в личном кабинете Честного знака),

\- url адрес ГИС МТ для работы. Значение по умолчанию для продуктивного контура - markirovka.crpt.ru.

\- ИНН организации (если предполагается работа с несколькими организациями).

![Изображение выглядит как текст, снимок экрана, программное обеспечение, число Автоматически созданное описание](/images/imark/2f63539ab2611e02fdad5430a711e669.png){.align-center}

Аналогичным образом добавляются остальные организации, если на торговой точке предполагается работа в разрезе нескольких юридических лиц с разделением запросов на проверку.

После сохранения организации будет вызван метод получения списка площадок из ГИС МТ и полный список CDN будет загружен и отображен на вкладке «Параметры iMark».

![Изображение выглядит как текст, снимок экрана, программное обеспечение, число Автоматически созданное описание](/images/imark/eb28ce2434478b2ef158a8805e6cbcd2.png){.align-center}

>   ВНИМАНИЕ! Если список площадок не загрузился, то необходимо убедиться в правильности указания токена и сравнить введенный токен в настройках с токеном в личном кабинете ГИС МТ. Только успешная загрузка площадок свидетельствует о правильности указания токена и только после появления площадок можно приступать к дальнейшей работе.
{.is-info}


Так же убедиться в корректности указания токена можно на стартовой странице iMark, отсканировав или введя вручную код маркировки. Если будет заполнен раздел с данными Честного знака по марке, то это свидетельствует о правильности указания токена.

![Изображение выглядит как текст, снимок экрана, Шрифт, линия Автоматически созданное описание](/images/imark/7bf81065af8226d973dff77bfbd86d58.png){.align-center}

## Дополнительные настройки

На вкладке Настройки – Параметры iMark можно задать ряд дополнительных настроек.

![Изображение выглядит как текст, снимок экрана, число, Шрифт Автоматически созданное описание](/images/imark/573c6bba9bdcd5a7e604cad845f77c6a.png){.align-center}

В поле «**Тип сервера**» выбирается один из двух доступных вариантов типов: SQL Lite локальный или MS SQL сервер.

В поле «**База данных**» указывается полный путь до базы данных (для варианта типа сервера SQL Lite) или имя базы (для варианта типа сервера MS SQL сервер).

Поля «**Драйвер**», «**Сервер**», «**Пользователь**» и «**Пароль**» указываются только при использовании MS SQL сервера.

![Изображение выглядит как текст, снимок экрана, число, Шрифт Автоматически созданное описание](/images/imark/c97424befae9a526fe8169da5065f537.png){.align-center}

![](/images/imark/4cee269d129ac6aa6e4beb102b755935.png){.align-center}

Настройка «**Файл журнала**» определяет место хранения файла с журналом работы службы. В этом журнале собираются все события взаимодействия клиентов с сервером и взаимодействия сервера с ГИС МТ.

![](/images/imark/52230844f66d9d9e1dc09ba401dbb826.png){.align-center}

«**Интервал опроса CDN ГИС МТ в часах**» определяет через какой интервал будет загружаться актуальный список CDN. Стандартный интервал 10 часов. Рекомендуется устанавливать обновление не чаще 1 раза в 6 часов.

![](/images/imark/ce7f1e009fc52e0b6bbf73607d7ed6f5.png){.align-center}

Включение параметра «**Не проверять КМ в локальной базе данных**» отключает внутренние проверки iMark полученного кода маркировки. В результате отключается контроль по локально базе уже проданных КМ.

>   Внимание! При установке Айтида iMark в связке с кассовым ПО Frontol 6 и xPOS3 рекомендуется **включить** **этот параметр**, т. к. Frontol 6 и xPOS3 посылают запрос с неполным КМ на проверку и в случае получения ошибки локальной проверки более ничего не отправляет. Без локальной проверки Frontol получает данные онлайн проверки из ГИС МТ и посылает повторно полный код маркировки на проверку.
{.is-warning}


![Изображение выглядит как текст, снимок экрана, Шрифт, линия Автоматически созданное описание](/images/imark/805f74fdaabcff594e2e02278c4dd84d.png){.align-center}

Раздел настроек с параметрами резервного копирования определяет **Интервал резервного копирования в часах** (по умолчанию 10 часов), место хранения резервных копий (параметр «**Папка для копии**»), а также отображает следующий номер резервной копии и дату последнего копирования.

# Настройка связи Айтида РМК с Айтида iMark

> Внимание! Работа с Модулем Регистрации Продаж версии 1 (МРП 1) не поддерживается. Для работы с разрешительным режимом на кассе необходимо перейти на Айтида РМК (МРП 2).
{.is-warning}


Для работы кассового программного обеспечения Айтида РМК по разрешительному режиму необходимо обновить базу данных и программу до версии 4.6.0 и установить и настроить Айтида iMark согласно данного руководства.

В справочниках схем РМК для целевой схемы на вкладке РМК/Кассиры - Обмен необходимо указать адрес сервера iMark для каждого рабочего места.

![Изображение выглядит как текст, линия, Шрифт, число Автоматически созданное описание](/images/imark/d80a60aae93e2a8f25fc534ccd068cfc.png){.align-center}

![Изображение выглядит как текст, программное обеспечение, число, Шрифт Автоматически созданное описание](/images/imark/3dece5507784801e37dbf4a9129abade.png){.align-center}

Указанные настройки автоматически попадают в РМК и доступны редактирования локально в параметрах РМК (Сервис – Параметры).

![Изображение выглядит как текст, линия, Шрифт, число Автоматически созданное описание](/images/imark/9e86822e8ba857f8866ba7260477ff94.png){.align-center}

В параметрах РМК параметр задается в формате: **IPадрес:IPпорт@Пароль**

После установки настроек связи с iMark можно переходить в режим продажи для регистрации маркированной продукции.

## Дополнительные настройки

Для изменения поведения при проверках кодов маркировки со стороны РМК присутствует обработка значений двух констант:

**\_РР_ПроверятьМРЦТабака** (логический тип). При установке значения Истина при проверке допустимости продажи будет сверяться МРЦ из прочитанного кода маркировки с МРЦ, указанным в ГИС МТ. Значение «Ложь» или отсутствие константы – сверка МРЦ в коде маркировки с МРЦ в ГИС МТ проверяться не будут.

**\_РР_ЗАПРЕТПРИОШИБКАХПРОВЕРКИ** (логический тип). При установке значения Истина будет заблокирована продажа с кодом маркировки, по которому обнаружены ошибки проверки на соответствие критериям. Значение «Ложь» или отсутствие константы – при наличии отклонений при проверке кода маркировки будет выведен вопрос продавцу с необходимостью подтвердить или отказаться от продажи товара с некорректным кодом маркировки.

# Проверка кодов маркировки в кассовом режиме

Проверка кодов маркировки в ГИС МТ выполняется только для чеков продажи.

>   Внимание! Для корректной работы механизма проверки кодов маркировки по разрешительному режиму требуется правильно настроить сканер на чтение всего кода маркировки, включая символы разделители GS (код символа - 29).
{.is-warning}


## Проверка при добавлении позиции

При добавлении маркированной позиции в чек и сканировании кода маркировки выполняется проверка отсканированного кода маркировки в iMark и в ГИС МТ. При отсутствии каких-либо отклонений по коду маркировки товар с этим кодом будет добавлен в чек.

При наличии отклонений при проверке кода маркировки, в зависимости от настроек (см п. 4.1) кассиру может быть выведен запрос на добавление товара с кодом маркировки в чек с перечнем отклонений.

![Изображение выглядит как текст, снимок экрана, Шрифт Автоматически созданное описание](/images/imark/0569acda21213872af1f5a87f8e59ec6.png){.align-center}

В этом окне клавиша Esc – отменяет добавление позиции в чек, клавиша Enter – подтверждает добавление позиции, несмотря на отклонения.

Так же может быть выведено уведомление о наличии отклонений без возможности добавления такого кода маркировки в чек.

![Изображение выглядит как текст, снимок экрана, Шрифт Автоматически созданное описание](/images/imark/771f97ba8aedbf4a726d463c417dcb6a.png){.align-center}

## Действие по завершению чека

При закрытии кассового чека серверу iMark будет передан состав позиций чека с кодами маркировки для фиксации факта продажи в iMark.

Если пробитие чека завершится ошибкой, то будет передан запрос на отмену пробиваемого чека в iMark, а при успешном пробитии чека будет отправлен запрос с подтверждением продажи в iMark и коды маркировки зафиксируются в базе в статусе «Продан».

## Проверка кодов маркировки в отложенных чеках.

Если чек с маркированной продукцией отложили, то при последующем его восстановлении будет инициирован процесс проверки всех его кодов маркировки через модуль iMark. При возникновении ошибок проверки кассиру будет выведен соответствующий диалог с перечнем ошибок, а в случае отказа от кода маркировки дальнейшие проверки будут прерваны. Необходимо будет убрать из чека некорректные коды маркировки и пробить чек без них.

# Интеграция Айтида iMark со сторонним программным обеспечением.

Модуль Айтида iMark поддерживает работу по формату Frontol Mark Unit. Благодаря этому модуль может быть интегрирован для совместной работы с кассовыми решениями Frontol 6 и Frontol xPOS 3.

>   Внимание! Текущие версии Frontol 6 и Frontol xPOS3 не умеют делить запросы проверки кодов маркировки по организациям, поэтому все запросы в ГИС МТ через iMark в связке с этим программным обеспечением будут выполняться по организации по умолчанию.
{.is-warning}

> Начиная с версии Фронтол 6.21 и xPOS 3.13 поддерживается разделение проверок КМ по организациям. Со стороны iMark работа с разделением по организациям по формату, используемому во Frontol, поддержана начиная с версии 1.02.272.
{.is-info}



## Frontol 6

Для работы в связке с Frontol 6 при работе по разрешительному режиму необходимо обновить Frontol 6 как минимум до версии 6.20.5.

В настройках Frontol 6 необходимо перейти в раздел ЕГАИС – Организации и в разделе настроек Frontol Alco Unit указать режим работы с маркированной продукцией «Строгий контроль кодов маркировки», а также указать адрес сервера, логин кассы и пароль по следующему шаблону:

![Изображение выглядит как текст, Шрифт, линия, число Автоматически созданное описание](/images/imark/47ca6b664841e019205dfd7203b412f9.png){.align-center}

**Веб-адрес Frontol Alco Unit**: указать в формате [**http://IPадрес_iMark:Порт_iMark**](http://IPадрес_iMark:Порт_iMark)

**Логин кассы:** необходимо указать код пользователя из параметров iMark

![Изображение выглядит как текст, снимок экрана, число, Шрифт Автоматически созданное описание](/images/imark/688d7b438569c8a6416dd422763af4e3.png){.align-center}

**Пароль:** указать пароль пользователя.

## Frontol xPOS 3

Для работы в связке с Frontol xPOS3 при работе по разрешительному режиму необходимо обновить Frontol xPOS3 как минимум до версии 3.12.3.

В настройках Frontol 6 необходимо перейти в раздел ЕГАИС – Frontol Mark Unit указать режим работы с маркированной продукцией «Строгий или нестрогий контроль маркированной продукции», а также указать адрес сервера, логин кассы и пароль по следующему шаблону:

![Изображение выглядит как текст, Шрифт, число, линия Автоматически созданное описание](/images/imark/c2ae543b6bbf088d96cb35c8a7948d52.png){.align-center}

**Url для отправки запросов:** указать в формате [**IPадрес_iMark:Порт_iMark**](http://IPадрес_iMark:Порт_iMark)

**Идентификатор кассы**: необходимо указать код пользователя из параметров iMark

![Изображение выглядит как текст, снимок экрана, число, Шрифт Автоматически созданное описание](/images/imark/688d7b438569c8a6416dd422763af4e3.png){.align-center}

**Пароль**: указать пароль пользователя.

## 1С Предприятие

Для интеграции с конфигурациями 1С рекомендуем воспользоваться партнёрским решением по ссылке: https://infostart.ru/marketplace/345395/
