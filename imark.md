---
title: iMark
description: Сервис для работы с маркированной продукцией
published: true
date: 2025-01-22T08:21:37.707Z
tags: маркировка, imark, проверка маркировки, сроки годности, статусы км
editor: markdown
dateCreated: 2023-12-04T17:38:33.872Z
---

# Введение

С 1 апреля 2024 года поэтапно вводится режим проверок на кассах для товаров, подлежащих маркировке для следующих категорий: табак, пиво, молочная продукция, упакованная вода, антисептики, БАД, обувь, фотоаппараты, шины, одежда, духи и безалкогольные напитки.  
С этой даты поэтапно наступает запрет продажи товара, подлежащего обязательной маркировке, если при проверке кода маркировки на кассе кассовое ПО выдало ошибку. Изменения будут направлены на улучшение контроля за товарооборотом на рынке, усиление борьбы с контрафактной продукцией и повышение защиты прав потребителей.

Более подробной информацией по разрешительному режиму можно ознакомиться на сайте: <https://markirovka.ru/community/rezhim-proverok-na-kassakh/rezhim-proverok-na-kassakh>

В рамках реализации функционала работы по разрешительному режиму наша компания разработала модуль Айтида iMark, который обеспечивает корректную проверку кодов маркировки, их обработку и интеграцию с кассовым программным обеспечением. Решение помогает бизнесу соответствовать требованиям законодательства и минимизировать риски, связанные с продажей немаркированной продукции.

# Что такое Айтида iMark?

## Описание программного модуля

Айтида iMark – это программный модуль, подключаемый к популярным кассовым решениям и обеспечивающий взаимодействие с ГИС МТ в части работы с разрешительным режимом согласно всем необходимым для этого требованиям.

Среди функциональных возможностей модуля присутствуют:

\- **Открытый API для интеграции**. Это позволяет подключить и использовать модуль совместно с любым кассовым решением.

\- **Возможность работы с несколькими юридическими лицами** для разделения проверок по своим токенам для каждого юридического лица,

\- **Работа с собственной базой данных** SQL Lite и MS SQL Server, а также автоматическое пополнение базы проданных кодов маркировки для последующего исключения повторных продаж без необходимости отправки запроса проверки в ГИС МТ

\- **Автоматическое резервное копирование** базы данных с заданным интервалом для повышения уровня надежности.

\- **Автоматическая фоновая работа с CDN**: получение списка, проверка доступности, расчет скорости отклика, актуализация и переключение между CDN для наиболее быстрого получения результата проверки. Полное соответствие требованиям к поведению ПО в случае аварийных ситуаций, описанных в методических рекомендациях Честного знака в пункте «1.4.3. Переключение между CDN-площадками», доступно начиная с релиза 1.02.

\- **Разграничение прав доступа** пользователей по ролям. Это позволит выдавать ограниченный доступ к API и обезопасить систему от необдуманных действий сотрудников.

\- **Удобный клиент для управления** и настройки сервера iMark. Варианты взаимодействия с сервером: 1) API; 2) Приложение для Windows; 3) Веб интерфейс.

\- **Ведение журнала** клиентских вызовов и журнала взаимодействия с ГИС МТ для обеспечения наличия технической информации и выполнении требования ППР №1944 в случае сбойных ситуаций (отсутствие интернета, сбой со стороны ГИС МТ…)

\- **Автоматическое обновление** встроенных модулей взаимодействия с ГИС МТ. В случае изменения алгоритмов взаимодействия с ГИС МТ, не требующих изменений в ядре службы, не потребуется вручную обновлять файлы службы. Все изменения загрузятся в модуль iMark автоматически с нашего сервера.

## Лицензирование

Версии Айтида iMark 1.0.3 и ранее распространялись бесплатно, но имели ограниченный срок действия до 31 марта 2025 года, то есть ровно год с момента выпуска первой версии. С 1 апреля 2025 года эти версии прекратят работу, и все запросы от приложений будут получать HTTP-ответ с кодом 402 (Payment Required) и сообщением: "The trial period has expired" («Пробный период истек»).

Для продолжения работы с модулем Айтида iMark необходимо обновиться до версии 1.0.4, которая требует наличия лицензии на подписку: «Айтида Release Pack 1 год для сервера» либо «S565 Айтида Release Pack 1 год для РМК/iMark».

Активация лицензии осуществляется через утилиту лицензирования, которая устанавливается вместе с модулем.

![Изображение выглядит как текст, снимок экрана, Шрифт, программное обеспечение Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/f3366db6cacd85635f985ebc3848fd42.png){.align-center}

В утилите активации необходимо ввести код активации, серийный номер лицензии и данные клиента, на которого активируется лицензия.

![Изображение выглядит как текст, электроника, снимок экрана, Шрифт Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/860b5e0552f35e5c0adf6f61d70fd000.png){.align-center}

После ввода данных необходимо нажать кнопку «Продолжить активацию» и выбрать вариант активации «Активировать через интернет в режиме online»

![Изображение выглядит как текст, снимок экрана, программное обеспечение, веб-страница Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/9086ee8b9dfabf3cfdef7c77b10e7b3c.png){.align-center}

В поле сервер активации должен быть указан сервер: **ils.itida.ru:99**

В случае успешной активации будет выведено сообщение:

![Изображение выглядит как текст, снимок экрана, программное обеспечение, Значок на компьютере Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/9f9d5075fa8f7410f1717384f700c842.png){.align-center}

В ответ на данное сообщение можно нажать нет и закрыть утилиту активации.

В утилите настройки при активной лицензии будет отображена дата окончания лицензии.

![](/images/imark/84743a0959f3d54eaf0b2b4ac9c3a2e3.png){.align-center}

Аналогичная информация будет отображаться и в веб-интерфейсе

![Изображение выглядит как текст, Шрифт, линия, снимок экрана Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/5f21e17dd46f80c405dbfa6a3bd24147.png){.align-center}

> При наличии активной лицензии программный продукт доступен для использования в течение установленного срока действия лицензии.
{.is-info}

# Быстрый старт

С процессом подготовки Айтида РМК к разрешительному режиму, а так же с настройкой и установкой модуля iMark можно ознакомиться [в обучающем видео](https://rutube.ru/video/cf68a1f49e7a3caaf2ce604939b6f5f1/).

[![](https://markdown-videos-api.jorgenkh.no/youtube/rORDJPWxTc8)](https://rutube.ru/video/cf68a1f49e7a3caaf2ce604939b6f5f1/)

# Установка и настройка модуля Айтида iMark.

## Загрузка и установка

Модуль поставляется в виде файла установки с расширением "exe".

![Изображение выглядит как текст, Шрифт, линия, снимок экрана Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/80a9ba34ec53345d09cfd99b8eb8d2d7.png){.align-center}

Для установки требуется запустить файл установки (например, **imark104.exe** ). Запустится процесс установки программы.

![Изображение выглядит как текст, снимок экрана, дизайн Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/c11034b68f4186e0fb6928a5d8969423.png){.align-center}

После принятия лицензионного соглашения требуется выбрать каталог установки программы.

![Изображение выглядит как текст, снимок экрана, Шрифт, дисплей Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/e8175a015d4ca2d3f0778b76cbd42741.png){.align-center}

По умолчанию программа устанавливается в каталог C:\\ItiData\\iMark. При необходимости можно поменять каталог установки. Так же, если предыдущая версия была установлена не через установщика, а путем ручной распаковки файлов и установки службы, то новую установку можно произвести поверх старой, указав в качестве каталога установки тот каталог, где располагается предыдущая установка модуля.

На следующем шаге необходимо указать имя устанавливаемого экземпляра и порт, на котором установленный экземпляр будет принимать соединения. В случае, если требуется установить несколько экземпляров службы (несколько служб) можно произвести установку всех экземпляров в единый каталог и для каждого указать своё уникальное имя и свой уникальный порт. В этом случае для каждого экземпляра будут созданы свои базы данных и свои файлы логов.

В стандартном случае, при установке одной службы, можно оставить стандартное имя экземпляра «imarksrv» и стандартный порт 8000.

![Изображение выглядит как текст, снимок экрана, программное обеспечение, число Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/2ab41b1a32d8866208feecfcc04477f9.png){.align-center}

На шаге выбора компонентов для установки необходимо выбрать требуемые компоненты для установки.

![Изображение выглядит как текст, снимок экрана, дисплей, Шрифт Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/882dd8f6f0736b9111ba8a2ec69b1f85.png){.align-center}

Начиная с версии 1.0.4 в комплект поставки включен установщик локального модуля честного знака (32-разрядная). Если локальный модуль Честного знака установлен отдельно или требуется установка 64-разрядной версии, то на этом этапе можно снять флаг с установки локального модуля и установить его самостоятельно по инструкции на сайте Честного знака: <https://честныйзнак.рф/local-module/>

Следующие шаги предлагают создать папку в меню Пуск для быстрого доступа к приложению iMark, а также ярлык на рабочем столе для открытия веб интерфейса. Если создавать ярлыки в меню пуск не требуется, то можно установить советующий флаг и нажать «Далее».

![Изображение выглядит как текст, снимок экрана, Шрифт, дисплей Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/1e58d930ddee0eb3e86deb910f747897.png){.align-center}

![Изображение выглядит как текст, снимок экрана, Шрифт Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/1fc77a0c5db3a90f17485ff1fee175e2.png){.align-center}

![Изображение выглядит как текст, электроника, снимок экрана, дисплей Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/d6e158a540fb76e786d500475deeccf5.png){.align-center}

Финальным этапом подготовки к установке является список выбранных компонентов к установке. По нажатию кнопки «Установить» запуститься процесс установки и копирования новых файлов.

Если установка производится поверх предыдущей версии и служба в данный момент запущена, то будет выведено соответствующее предупреждение с предложением автоматически остановить службу для обновления.

![Изображение выглядит как текст, электроника, снимок экрана, дисплей Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/fc119bbcbfefe482cff12ad2147e1e3d.png){.align-center}

Если при установке была выбрана установка локального модуля Честного знака, то после распаковки файлов приложения будет запущена установка локального модуля.

![Изображение выглядит как текст, снимок экрана, программное обеспечение, дисплей Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/f88f2b740709419cde3d311b2c7053ac.png){.align-center}

Установщик ЛМ ЧЗ автоматически определит каталог для своей установки. На шаге с установкой каталога требуется установить флаг «Добавить сервисы Локального Модуля в автозапуск».

![Изображение выглядит как текст, снимок экрана, программное обеспечение, Значок на компьютере Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/0dd180840acdc712309ddfbfb62368b8.png){.align-center}

Если производится повторная установка локального модуля или его обновление на новую версию, то на этом этапе будет предложено заменить существующие файлы конфигурации (т. е. переписать их новыми с перезаписью имеющихся).

![Изображение выглядит как текст, снимок экрана, программное обеспечение, Значок на компьютере Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/32efad1f0dd6ca6afc26bb0273053a46.png){.align-center}

Если не нужно заново конфигурировать модуль и менять к нему параметры доступа, то можно нажать кнопку «Нет» в ответ на вопрос и не заменять существующие файлы.

Для первичной установки локального модуля или для варианта, когда на предыдущем шаге согласились с заменой файлов конфигурации, будет предложено ввести данные для авторизации запросов в локальном модуле.

![Изображение выглядит как текст, снимок экрана, программное обеспечение, дисплей Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/e719dfbe58959f426e7d3f31f27f5508.png){.align-center}

Нужно обязательно установить имя профиля (например, admin) и пароль (например, admin) и запомнить введенные значения. Они будут использованы при подключении локального модуля в настройках iMark.

Следующим этапом требуется заполнить URL сервера, к которому локальный модуль обращается за обновлением базы данных заблокированных КИ и GTIN.

По умолчанию в поле уже введен адрес продуктивного контура: https://rsapi.crpt.ru

![Изображение выглядит как текст, снимок экрана, программное обеспечение, дисплей Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/c7caa5a6f1cd32ca1fd1e6911e1b6740.png){.align-center}

После установки URL адреса требуется заполнить параметры используемого прокси-сервера.

Если прокси-сервер не используется, то поля заполнять не требуется.

![Изображение выглядит как текст, снимок экрана, программное обеспечение, дисплей Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/0a504d42971a6f74cb20d9e87a7383df.png){.align-center}

После этого останется только нажать кнопку «Начать» для установки и запуска службы локального модуля.

![Изображение выглядит как текст, снимок экрана, программное обеспечение, дисплей Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/e9c12bbd5d170431e74e27ae9c620dbe.png){.align-center}

По завершению установки локального модуля требуется нажать кнопку «Готово» в установщике ЛМ ЧЗ, а в установщике iMark выбрать приложение для запуска настроек модуля: приложение для Windows или веб-интерфейс.

![Изображение выглядит как текст, снимок экрана, дизайн Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/a4d579badfbdd4dcf68a261a3c9897d6.png){.align-center}

При запуске службы, если она устанавливается первый раз, будет автоматически создана база SQL Lite в каталоге службы и с именем равным имени службы.

![База данных SQL Lite](/images/imark/0d0291d9e5271838604cd29b5360f051.png){.align-center}

Для переключения на другой тип базы данных, а также для изменения прочих настроек необходимо воспользоваться клиентом, запустив **imarkcln.exe**.

## Начальная настройка

![Изображение выглядит как текст, снимок экрана, Шрифт, Операционная система Автоматически созданное описание](/images/imark/b3fa367f29c1ca9ec8ea504679503488.png){.align-center}

При запуске будут запрошены уникальный пароль пользователя, а также IP адрес и порт сервера, к которому требуется подключиться для настройки.

По умолчанию в базе данных присутствует пользователь Администратор с правом настроек и паролем **123**, а также пользователь Касса с паролем **1**.

Авторизовавшись под пользователем с правом настроек, откроется главная страница приложения с функционалом проверки кодов маркировки.

![Изображение выглядит как текст, снимок экрана, программное обеспечение, компьютер Автоматически созданное описание](/images/imark/85a7e6b8c667b81e7ac0368db29a4780.png){.align-center}

>   Перед установкой настроек следует определиться с какой базой данных будет производиться работа. Если требуется переключиться на MS SQL сервер, то это требуется произвести до того, как будут заданы первые настройки через клиент, т. к. при переключении типа базы, если такая база отсутствует, будет создана новая база данных с настройками по умолчанию.
{.is-warning}


Для перехода к настройкам необходимо переключиться на вкладку «Настройки» и в разделе «Справочники» у созданной по умолчанию организации указать:

- наименование,

- токен доступа в ГИС МТ (полученный в личном кабинете Честного знака),

- URL адрес ГИС МТ для работы. Значение по умолчанию для продуктивного контура - markirovka.crpt.ru.

- ИНН организации (обязательно для заполнения, если предполагается работа с несколькими организациями).

- Флаг "Основная" устанавливается для организации, которая будет использована для запросов проверок, в которых не указан ИНН организации.

![Изображение выглядит как текст, снимок экрана, программное обеспечение, число Автоматически созданное описание](/images/imark/2f63539ab2611e02fdad5430a711e669.png){.align-center}

Аналогичным образом добавляются остальные организации, если на торговой точке предполагается работа в разрезе нескольких юридических лиц с разделением запросов на проверку.

После сохранения организации будет вызван метод получения списка площадок из ГИС МТ и полный список CDN будет загружен и отображен на вкладке «Параметры iMark».

![Изображение выглядит как текст, снимок экрана, программное обеспечение, число Автоматически созданное описание](/images/imark/806507154907aab50e5d8abf94cf5465.png){.align-center}

>   ВНИМАНИЕ! Если список площадок не загрузился, то необходимо убедиться в правильности указания токена и сравнить введенный токен в настройках с токеном в личном кабинете ГИС МТ. Только успешная загрузка площадок свидетельствует о правильности указания токена и только после появления площадок можно приступать к дальнейшей работе.
{.is-info}


Так же убедиться в корректности указания токена можно на стартовой странице iMark, отсканировав или введя вручную код маркировки. Если будет заполнен раздел с данными Честного знака по марке, то это свидетельствует о правильности указания токена.

![Изображение выглядит как текст, снимок экрана, Шрифт, линия Автоматически созданное описание](/images/imark/7bf81065af8226d973dff77bfbd86d58.png){.align-center}

## Дополнительные настройки

На вкладке Настройки – Параметры iMark можно задать ряд дополнительных настроек.

![Изображение выглядит как текст, снимок экрана, число, Шрифт Автоматически созданное описание](/images/imark/fc4aad49229dce469f14f43610dcc420.png){.align-center}

Параметр **«Адрес и порт сервера лицензий»** позволяет указать адрес сервера, на котором установлена лицензия для работы модуля iMark для случаев, когда сервер с лицензиями и iMark расположены на разных компьютерах.

**«Email для уведомлений»** - адрес электронной почты, куда будут отправляться уведомления о скором истечении срока действия лицензий.

В поле «**Тип сервера**» выбирается один из двух доступных вариантов типов: SQL Lite локальный или MS SQL сервер.

В поле «**База данных**» указывается полный путь до базы данных (для варианта типа сервера SQL Lite) или имя базы (для варианта типа сервера MS SQL сервер).

Поля «**Драйвер**», «**Сервер**», «**Пользователь**» и «**Пароль**» указываются только при использовании MS SQL сервера.

![Изображение выглядит как текст, снимок экрана, число, Шрифт Автоматически созданное описание](/images/imark/c97424befae9a526fe8169da5065f537.png){.align-center}

![](/images/imark/4cee269d129ac6aa6e4beb102b755935.png){.align-center}

Настройка «**Файл журнала**» определяет место хранения файла с журналом работы службы. В этом журнале собираются все события взаимодействия клиентов с сервером и взаимодействия сервера с ГИС МТ.

![](/images/imark/52230844f66d9d9e1dc09ba401dbb826.png){.align-center}

«**Интервал опроса CDN ГИС МТ в часах**» определяет через какой интервал будет загружаться актуальный список CDN. Стандартный интервал 10 часов. Рекомендуется устанавливать обновление не чаще 1 раза в 6 часов.

![Изображение выглядит как текст, снимок экрана, Шрифт, линия Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/93a03c7fa0f685109a37d9e704779a20.png){.align-center}

**«Интервал ожидания проверки КМ в мсек»** определяет максимальное время ожидания ответа при онлайн-проверке кода маркировки. Значение указывается в миллисекундах и по умолчанию составляет 1500 мс (1,5 секунды) в соответствии с ПП РФ № 1944.

![](/images/imark/ce7f1e009fc52e0b6bbf73607d7ed6f5.png){.align-center}

Включение параметра «**Не проверять КМ в локальной базе данных**» отключает внутренние проверки iMark полученного кода маркировки. В результате отключается контроль по локальной базе уже проданных КМ.

>   Внимание! При установке Айтида iMark в связке с кассовым ПО Frontol 6 и xPOS3 рекомендуется **включить** **этот параметр**, т. к. Frontol 6 и xPOS3 посылают запрос с неполным КМ на проверку и в случае получения ошибки локальной проверки более ничего не отправляет. Без локальной проверки Frontol получает данные онлайн проверки из ГИС МТ и посылает повторно полный код маркировки на проверку.
{.is-warning}


![Изображение выглядит как текст, снимок экрана, Шрифт, линия Автоматически созданное описание](/images/imark/805f74fdaabcff594e2e02278c4dd84d.png){.align-center}

Раздел настроек с параметрами резервного копирования определяет **Интервал резервного копирования в часах** (по умолчанию 10 часов), место хранения резервных копий (параметр «**Папка для копии**»), а также отображает следующий номер резервной копии и дату последнего копирования.

## Подключение Локального Модуля Честного знака.

В карточке организации в настройках iMark добавлены поля для указания адреса установленного Локального Модуля Честного знака (далее ЛМ ЧЗ).

![Изображение выглядит как текст, снимок экрана, число, Шрифт Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/1a05ba413bd080d9bf676d92563e624a.png){.align-center}

В поле «**Адрес и порт ЛМ ЧЗ**» необходимо указать IP адрес ПК с установленным локальным модулем и через двоеточие указать порт (обычно используется порт 5995).

Если локальный модуль установлен на том же ПК, что и Айтида iMark, то в качестве адреса и порта ЛМ ЧЗ можно указать: 127.0.0.1:5995

**Пользователь:** указать имя пользователя, указанное при установке ЛМ ЧЗ.

**Пароль:** указать пароль пользователя, указанный при установке ЛМ ЧЗ.

После указания параметров связи необходимо записать карточку организации.

В списке организаций отобразится статус локального модуля.

![](/images/imark/00437071e3a79625b23a6acbaeaa9a3c.png){.align-center}

Если статус локального модуля не отображается, то нужно перейти в настройки подключения и в разделе «Скрипты» убедиться, что используется версия скриптов не ниже, чем 1.0.4.385.

![Изображение выглядит как текст, снимок экрана, число, Шрифт Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/53edc552ff4f62393435c5160f559c93.png){.align-center}

Если версия скриптов ниже указанной, то необходимо обновить скрипты с сервера.

Если статус локального модуля отображается как «Не сконфигурирован», то для начала работы с ним потребуется произвести инициализацию локального модуля. Для этого в карточке организации требуется нажать на соответствующую кнопку.

![Изображение выглядит как текст, снимок экрана, Шрифт, число Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/00049a6aaa1b801b13a1a67a3d63d628.png){.align-center}

После получения сообщения об успешной отправке запроса инициализации можно закрыть карточку организации. В списке организаций статус модуля поменяется на «Инициализация».

![Изображение выглядит как текст, снимок экрана, линия, Шрифт Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/dad69daa59b52d21f039184757ff7d37.png){.align-center}

Спустя какое-то время, когда модуль инициализируется и загрузит черные списки, статус его поменяется на «Готов», что можно будет пронаблюдать в списке организаций и в карточке организации. В таком статусе модуль готов к проверке кодов маркировки, проверка которых в онлайн прошла неудачно (не получен ответ).

![Изображение выглядит как текст, снимок экрана, Шрифт, линия Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/2c7b42d3d5d2da85f49ba14cfbbcc742.png){.align-center}

![Изображение выглядит как текст, снимок экрана, Шрифт, число Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/cc1b8bf3a9883f2c1fa6c7ec5a9838c2.png){.align-center}

## Схема проверки кодов маркировки через локальный модуль

При проверке кодов маркировки согласно ППРФ 1944 сперва выполняется онлайн проверка кода маркировки и, если за отведенный интервал в 1.5 секунд не получили ответ на онлайн проверку, то производится проверка оффлайн через локальный модуль честного знака.

В локальном модуле код маркировки проверяется на наличие в черных списках и возвращается ответ с признаком блокировки кода маркировки: заблокирован или не заблокирован. Если код маркировки не заблокирован, то его можно продавать.

Для тестирования работоспособности проверок через локальный модуль в связке с Айтида iMark можно в карточке организации указать вместо основного URL для работы онлайн проверок markirovka.crpt.ru временный nocdn.crpt.ru. Это служебное внутреннее имя хоста, в действительности такого домена не существует. При указании такого имени основного адреса очистится список всех cdn площадок и не будут работать онлайн проверки кодов маркировки, а проверки будут только через локальный модуль.

После проведения тестирования необходимо обязательно вернуть основной URL в карточке организации в значение markirovka.crpt.ru. Использование иных адресов для рабочего режима и нормального функционирования режима проверок не допускается.

# Настройка связи Айтида РМК с Айтида iMark

> Внимание! Работа с Модулем Регистрации Продаж версии 1 (МРП 1) не поддерживается. Для работы с разрешительным режимом на кассе необходимо перейти на Айтида РМК (МРП 2).
{.is-warning}


Для работы кассового программного обеспечения Айтида РМК по разрешительному режиму необходимо обновить базу данных и программу до версии 4.7.0 и установить и настроить Айтида iMark согласно данному руководству.

В справочниках схем РМК для целевой схемы на вкладке РМК/Кассиры - Обмен необходимо указать адрес сервера iMark для каждого рабочего места.

![Изображение выглядит как текст, линия, Шрифт, число Автоматически созданное описание](/images/imark/d80a60aae93e2a8f25fc534ccd068cfc.png){.align-center}

![Изображение выглядит как текст, программное обеспечение, число, Шрифт Автоматически созданное описание](/images/imark/3dece5507784801e37dbf4a9129abade.png){.align-center}

Указанные настройки автоматически попадают в РМК и доступны для редактирования локально в параметрах РМК (Сервис – Параметры).

![Изображение выглядит как текст, линия, Шрифт, число Автоматически созданное описание](/images/imark/9e86822e8ba857f8866ba7260477ff94.png){.align-center}

В параметрах РМК параметр задается в формате: **IPадрес:IPпорт@Пароль**

После установки настроек связи с iMark можно переходить в режим продажи для регистрации маркированной продукции.

## Разделение проверок по разрешительному режиму по организациям

При работе на кассе с несколькими юр.лицами и необходимости разделения проверок маркированной продукции по разрешительному режиму по организациям необходимо выполнить следующие действия:
- В справочнике фирм (Справочники - Фирмы) в каждой фирме указать ИНН организации 
	![firm_inn.png](/images/imark/firm_inn.png){.align-center}
- В карточках групп ресурсов (Справочники - Классификаторы - Группы ресурсов) указать код фискального регистратора в поле "Номер ФР". 
	![gr_frcode.png](/images/imark/gr_frcode.png){.align-center}
- В карточках товара выбрать соответствующие им группы ресурсов.
- В карточках торгового оборудования для фискальных регистраторов указать код ФР и выбрать фирму.
	![fr_firm_frcode.png](/images/imark/fr_firm_frcode.png){.align-center}

Со стороны iMark необходимо в каждой организации указать ИНН.

![imark_firm.png](/images/imark/imark_firm.png){.align-center}

При таких настройках в запросах проверки из Айтида РМК будет заполняться ИНН фирмы из подключенного торгового оборудования и iMark проверки будет производить по организации, у которой ИНН совпадает с ИНН из запроса. Если ИНН будет не указан в запросе на проверку КМ, то проверка КМ будет произведена по организации, помеченной в iMark как "Основная".

## Дополнительные настройки

Для изменения поведения при проверках кодов маркировки со стороны РМК присутствуют следующие настройки:

1.  Константа **\_РР_ПроверятьМРЦТабака** (логический тип). При установке значения Истина при проверке допустимости продажи будет сверяться МРЦ из прочитанного кода маркировки с МРЦ, указанным в ГИС МТ. Значение «Ложь» или отсутствие константы – сверка МРЦ в коде маркировки с МРЦ в ГИС МТ проверяться не будут.
2.  Так же блокировкой или разрешением продажи кодов маркировки при наличии ошибок проверки (запрещающих критериев для продажи) управляет право пользователя в схеме РМК - **Продажа КМ с ошибками проверки в ГИС МТ**. По умолчанию право установлено в значение «**Не доступно для использования»** для исключения случаев продажи с ошибками проверки. Для исключительных случаев можно переключить в значение «Разрешено только администратору» или «Разрешено всем».

	![Изображение выглядит как текст, снимок экрана, число, Шрифт Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/044ed7aaa589ee26591f0fc43612cf5d.png){.align-center}

3.  Для управление действием при пустых ответах от ГИС МТ и ЛМ ЧЗ и во избежание получения предупреждений или предписаний надзорных органов в схеме РМК присутствует настройка «**Действие при отсутствии ответа от ГИС МТ**». Для варианта «Запретить продажу» при пустых ответах в случае отсутствия связи с ГИС МТ и ЛМ ЧЗ продажа будет блокироваться. В варианте «Спросить у кассира» кассиру будет предложен выбор разрешить такую продажу или запретить. Вариант «Разрешить продажу» будет позволять продавать при отсутствии ответа от ГИС МТ и ЛМ ЧЗ.

    Рекомендуемым вариантом в данной настройке является «**Запретить продажу**», поскольку продажа без заполнения тэга 1260 недопустима.

    ![Изображение выглядит как текст, снимок экрана, программное обеспечение, веб-страница Контент, сгенерированный ИИ, может содержать ошибки.](/images/imark/a59ba587346cf773005cacd892866832.png){.align-center}

# Проверка кодов маркировки в кассовом режиме

Проверка кодов маркировки в ГИС МТ выполняется только для чеков продажи.

>   Внимание! Для корректной работы механизма проверки кодов маркировки по разрешительному режиму требуется правильно настроить сканер на чтение всего кода маркировки, включая символы разделители GS (код символа - 29).
{.is-warning}


## Проверка при добавлении позиции

При добавлении маркированной позиции в чек и сканировании кода маркировки выполняется проверка отсканированного кода маркировки в iMark и в ГИС МТ. При отсутствии каких-либо отклонений по коду маркировки товар с этим кодом будет добавлен в чек.

При наличии отклонений при проверке кода маркировки, в зависимости от настроек (см п. 4.1) кассиру может быть выведен запрос на добавление товара с кодом маркировки в чек с перечнем отклонений.

![Изображение выглядит как текст, снимок экрана, Шрифт Автоматически созданное описание](/images/imark/0569acda21213872af1f5a87f8e59ec6.png){.align-center}

В этом окне клавиша Esc – отменяет добавление позиции в чек, клавиша Enter – подтверждает добавление позиции, несмотря на отклонения.

Так же может быть выведено уведомление о наличии отклонений без возможности добавления такого кода маркировки в чек.

![Изображение выглядит как текст, снимок экрана, Шрифт Автоматически созданное описание](/images/imark/771f97ba8aedbf4a726d463c417dcb6a.png){.align-center}

## Действие по завершению чека

При закрытии кассового чека серверу iMark будет передан состав позиций чека с кодами маркировки для фиксации факта продажи в iMark.

Если пробитие чека завершится ошибкой, то будет передан запрос на отмену пробиваемого чека в iMark, а при успешном пробитии чека будет отправлен запрос с подтверждением продажи в iMark и коды маркировки зафиксируются в базе в статусе «Продан».

## Проверка кодов маркировки в отложенных чеках.

Если чек с маркированной продукцией отложили, то при последующем его восстановлении будет инициирован процесс проверки всех его кодов маркировки через модуль iMark. При возникновении ошибок проверки кассиру будет выведен соответствующий диалог с перечнем ошибок, а в случае отказа от кода маркировки дальнейшие проверки будут прерваны. Необходимо будет убрать из чека некорректные коды маркировки и пробить чек без них.

# Интеграция Айтида iMark со сторонним программным обеспечением.

Модуль Айтида iMark поддерживает работу по формату Frontol Mark Unit. Благодаря этому модуль может быть интегрирован для совместной работы с кассовыми решениями Frontol 6 и Frontol xPOS 3.

>   Внимание! Текущие версии Frontol 6 и Frontol xPOS3 не умеют делить запросы проверки кодов маркировки по организациям, поэтому все запросы в ГИС МТ через iMark в связке с этим программным обеспечением будут выполняться по организации по умолчанию.
{.is-warning}

> Начиная с версии Фронтол 6.21 и xPOS 3.13 поддерживается разделение проверок КМ по организациям. Со стороны iMark работа с разделением по организациям по формату, используемому во Frontol, поддержана начиная с версии 1.02.272.
{.is-info}



## Frontol 6

Для работы в связке с Frontol 6 при работе по разрешительному режиму необходимо обновить Frontol 6 как минимум до версии 6.20.5.

В настройках Frontol 6 необходимо перейти в раздел ЕГАИС – Организации и в разделе настроек Frontol Alco Unit указать режим работы с маркированной продукцией «Строгий контроль кодов маркировки», а также указать адрес сервера, логин кассы и пароль по следующему шаблону:

![Изображение выглядит как текст, Шрифт, линия, число Автоматически созданное описание](/images/imark/47ca6b664841e019205dfd7203b412f9.png){.align-center}

**Веб-адрес Frontol Alco Unit**: указать в формате [**http://IPадрес_iMark:Порт_iMark**](http://IPадрес_iMark:Порт_iMark)

**Логин кассы:** необходимо указать код пользователя из параметров iMark

![Изображение выглядит как текст, снимок экрана, число, Шрифт Автоматически созданное описание](/images/imark/688d7b438569c8a6416dd422763af4e3.png){.align-center}

**Пароль:** указать пароль пользователя.

## Frontol xPOS 3

Для работы в связке с Frontol xPOS3 при работе по разрешительному режиму необходимо обновить Frontol xPOS3 как минимум до версии 3.12.3.

В настройках Frontol 6 необходимо перейти в раздел ЕГАИС – Frontol Mark Unit указать режим работы с маркированной продукцией «Строгий или нестрогий контроль маркированной продукции», а также указать адрес сервера, логин кассы и пароль по следующему шаблону:

![Изображение выглядит как текст, Шрифт, число, линия Автоматически созданное описание](/images/imark/c2ae543b6bbf088d96cb35c8a7948d52.png){.align-center}

**Url для отправки запросов:** указать в формате [**IPадрес_iMark:Порт_iMark**](http://IPадрес_iMark:Порт_iMark)

**Идентификатор кассы**: необходимо указать код пользователя из параметров iMark

![Изображение выглядит как текст, снимок экрана, число, Шрифт Автоматически созданное описание](/images/imark/688d7b438569c8a6416dd422763af4e3.png){.align-center}

**Пароль**: указать пароль пользователя.

## 1С Предприятие

Для интеграции с конфигурациями 1С рекомендуем воспользоваться партнёрским решением по ссылке: https://infostart.ru/marketplace/345395/
