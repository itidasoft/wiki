---
title: Айтида РМК и драйвер принтеров чеков Атол
description: Подключение принтеров чеков
published: false
date: 2024-11-26T14:36:09.867Z
tags: принтер чеков, печать марок
editor: markdown
dateCreated: 2024-11-25T07:13:10.881Z
---

# Обновление Айтиды

Функционал подключения принтера доступен начиная с версии Айтида 4.5.6. Так же в версии 4.6.5 функционал расширен – добавлена обработка признака печати марок для исключения повторной печати марок на позиции с напечатанной маркой.

# Добавление профиля для работы с принтером

Необходимо перейти в режиме расширенного конфигурирования в справочник профилей оборудования и загрузить новый профиль из файла **«ПРОФИЛЬ ПРИНТЕРА ЧЕКОВ (ДРАЙВЕР АТОЛ).CNT»**

![Изображение выглядит как текст, снимок экрана, программное обеспечение, Значок на компьютере Автоматически созданное описание](/images/integrations/chequeprinter/8a5012ef3caacec12ed65413778432a6.png)

Загружаемый профиль будет отображаться в программе под названием «Принтер чеков (драйвер Атол V8)»

# Установка драйвера для работы с принтером

Для работы с принтерами чеков в Айтида РМК используется драйвер принтеров чеков от компании АТОЛ, который входит в комплект поставки платно распространяемого пакета драйверов под названием «Frontol Driver Unit». Потребуется скачать и установить драйвер по инструкции от разработчика драйвера, а также приобрести и активировать лицензию на драйвер. Без лицензии драйвер не работает со сторонними приложениями.

Для целей тестирования может быть активирована временная лицензия на драйвер на 45 дней. Подробная информация о процедуре получения и активации временной лицензии содержится в руководстве к ПО Frontol Driver Unit.

# Настройка торгового оборудования

После добавления профиля, установки драйвера и активации лицензии на драйвер необходимо перейти к созданию карточек оборудования для настройки связи с принтерами чеков.

Для этого в справочнике торгового оборудования (Параметры – Торговое оборудование) необходимо создать новую карточку по следующему шаблону:

![Изображение выглядит как текст, снимок экрана, программное обеспечение, веб-страница Автоматически созданное описание](/images/integrations/chequeprinter/5961e67cd8c5b206cc89cc42f8c7513b.png)

**Наименование:** указать произвольное наименование оборудования

**Тип оборудования:** выбрать «Принтер чеков»

**Профиль:** выбрать профиль под названием «Принтер чеков (драйвер Атол V8)»

**Устройство:** логические устройства из драйвера не загружаются, а создаются в момент работы с драйвером при печати, поэтому выбор устройства не требуется.

**Склад нахождения, Денежный карман, Юр.лицо:** выбрать значения на свое усмотрение

**Номер ФР:** здесь необходимо указать код фр, который **не будет совпадать** с имеющимися кодами ФР в карточках фискальных регистраторов (если имеются подключенные фискальные регистраторы с разделением печати по ФР).

**Флаг «Отсоединяться от устройства после окончания операции»:** необходимо установить, чтобы не блокировать печать на принтеры с других рабочих мест.

Далее необходимо сохранить карточку торгового оборудования по кнопке «Записать» и открыть её заново для настройки связи с физическим устройством. После открытия карточки и нажатия кнопки **«Настройка драйвера оборудования»** откроется диалог драйвера для установки параметров связи.

![Изображение выглядит как текст, снимок экрана, программное обеспечение, веб-страница Автоматически созданное описание](/images/integrations/chequeprinter/7791fe468e43e00f2f13d26726dd5dd0.png)

После установки параметров связи с принтером требуется убедиться в корректности настроенных параметров вызвав проверку связи по нажатию соответствующей кнопки. Результатом успешной проверки будет сообщение **«(0) Ошибок нет [Принтер готов к работе]»** в поле **«Результат».**

Для сохранения настроек требуется нажать «ОК» в диалоге драйвера и сохранить карточку оборудования по кнопке «Записать».

Внимание! Параметры связи с каждым принтером хранятся в базе Айтида. Если доступ к принтеру осуществляется с разных рабочих мест, то ко всем рабочим местам будут применяться одинаковые настройки связи, сохраненные для карточки торгового оборудования.

По аналогии с описанным процессом настройки оборудования добавляются все остальные карточки оборудования для всех принтеров в заведении.

# Настройка схемы РМК

## Добавление оборудования для рабочего места
В схеме РМК требуется добавить созданные карточки торгового оборудования для принтеров чеков. Для этого для требуемых рабочих мест они добавляются на вкладке «РМК/кассиры» - «Оборудование».

![Изображение выглядит как текст, снимок экрана, программное обеспечение, число Автоматически созданное описание](/images/integrations/chequeprinter/0ee78fa97669df5a0c95f6c383395d66.png)

## Печать марок вручную

Присутствует функционал ручной печати марок через функцию «Печать пречека». Для активации этой функции требуется на вкладке «Печать/Операции» - «Операции» активировать функцию «Печать копии чека».

![Изображение выглядит как текст, снимок экрана, число, программное обеспечение Автоматически созданное описание](/images/integrations/chequeprinter/f4861f43fba9b1553eee3db39945b289.png)

После этого появится кнопка на панели инструментов РМК.

![Изображение выглядит как текст, снимок экрана, Шрифт, число Автоматически созданное описание](/images/integrations/chequeprinter/a0786ab8a8c3939c47504f7f50467c19.png)

При вызове данной операции в открытом чеке будет предложен выбор на каком устройстве произвести печать.

![Изображение выглядит как текст, снимок экрана, Шрифт, число Автоматически созданное описание](/images/integrations/chequeprinter/c852ce127b1bf2972b596902571a313c.png)

Если выбрать для печати принтер чеков, то на него будут отправлены только те позиции из регистрации, в которых группа печати марки совпадает с кодом ФР в карточке принтера.

## Функция вызова печати марок
Для печати марок на принтер через клавиатурную функцию необходимо на вкладке «Клавиатура» в схеме РМК добавить вызов скрипта. 
Текст скрипта:
```js
//печатаем марки на принтерах чеков
IF ( !EQUIPMENT.ПечатьМарокНаПринтереЧеков() )
	RETURN false;

RETURN true;
```
Пример настройки показан ниже.

![Изображение выглядит как текст, снимок экрана, число, программное обеспечение Автоматически созданное описание](/images/integrations/chequeprinter/27e1ec49ba9fc4551f532e4f530a3046.png)

![Изображение выглядит как текст, снимок экрана, программное обеспечение, дисплей Автоматически созданное описание](/images/integrations/chequeprinter/e982430e617da31715fbc60850041bea.png)

## Автоматическая печать марок перед вводом оплат чека
Если требуется печатать марки автоматически перед завершением пробития чека, то в схеме РМК на вкладке «ЕГАИС и скрипты» в скрипт проверки значений и прав доступа необходимо добавить скрипт:
```js
IF ( _ИМЯПОЛЯ == "payment"  )
{
	//печатаем марки на принтерах чеков
	IF ( !EQUIPMENT.ПечатьМарокНаПринтереЧеков() )
		RETURN false;
}
RETURN true;
```

![Изображение выглядит как текст, снимок экрана, программное обеспечение, Значок на компьютере Автоматически созданное описание](/images/integrations/chequeprinter/836e853d2d19755b70872ad1985992cd.png)

## Автоматическая печать марок при откладывании, отмене чека и удалении позиции

Для активации функционала автоматической печати марок при отмене чека (когда клиент отказался от заказа и на кухню нужно послать отмену приготовления), при откладывании (когда чек восстановили для добавления новых позиций и вернули в отложенные), а так же при удалении позиции (когда нужно послать отказ от конкетной позиции в заказе на принтер) необходимо в схеме РМК в скрипт проверки значений и прав доступа добавить следующий скрипт:

```js
IF ( !EQUIPMENT.ОбработкаПечатиМарокВРМК() )
	RETURN false;

RETURN true;
```

![2024-11-26_16-28-02.png](/images/integrations/chequeprinter/2024-11-26_16-28-02.png)

## Контроль повторной печати марок

Для исключения ситуации с повторной печатью марок для позиций с уже напечатанной маркой присутствует обработка дополнительных свойств строки. Для добавления таких свойств необходимо скачать файл с параметрами по ссылке: [параметры_принтерчеков.cnt](/images/integrations/chequeprinter/параметры_принтерчеков.cnt)

После скачивания параметры из файла необходимо загрузить в справочник параметров системы
![image.png](/images/integrations/chequeprinter/image.png).

Далее в схеме РМК на вкладке Печать/Операции - Доп. свойства добавить дополнительные свойства для строки с названием МаркаНапечатана.

![2024-11-26_16-35-59.png](/images/integrations/chequeprinter/2024-11-26_16-35-59.png)

В файле так же присутствуют два дополнительных параметра: "НомерСтола" - используется для ввода номера стола при формировании нового заказа, и "КоличествоГостей" - используется для указания количества гостей за столом. Эти параметры могут быть запрошены системой автоматически при создании нового заказа. Подробнее смотри в следующем разделе.

## Подключение обработчика для запроса произвольных данных

Для автоматического запроса параметров с номером стола и количеством гостей (см [предыдущий раздел](#Контроль_повторной_печати_марок)) необходимо [скачать профиль "Информер HoReCa".cnt](/images/integrations/chequeprinter/профиль_informer_horeca.cnt) и загрузить в справочник профилей оборудования.

Далее создать карточку оборудования по следующему шаблону:
![2024-11-26_16-46-19.png](/images/integrations/chequeprinter/2024-11-26_16-46-19.png)
**Наименование:** - любое произвольное наименование оборудования
**Тип оборудования:** - Прочее оборудование
**Профиль:** - Информер HoReCa

Добавить созданную карточку оборудования в схему РМК для нужных рабочих мест.
![2024-11-26_16-48-26.png](/images/integrations/chequeprinter/2024-11-26_16-48-26.png)

После подключения можно перейти в режим продаж в РМК и при добавлении новой позиции для нового заказа будет запрошен ввод параметров заказа. 
![2024-11-26_16-50-50.png](/images/integrations/chequeprinter/2024-11-26_16-50-50.png)

> Введенные параметры количества гостей и номера стола могут быть напечатаны на принтере чеков при печати марок.
{.is-info}

> Количество и состав запрашиваемых параметров может быть произвольным образом дополнен за счет добавления новых параметров, доп свойств и своих обработчиков в профиль "Информер HoReCa".
{.is-info}


# Подготовка карточек товаров

Для привязки печати марок по товарам к определенным принтерам требуется в карточках товаров заполнить дополнительной свойство под названием «КодГруппыПечатиМарки».

![Изображение выглядит как текст, снимок экрана, программное обеспечение, Значок на компьютере Автоматически созданное описание](/images/integrations/chequeprinter/40c5ad7fbf94847d8d10697e2bf042b3.png)

Значение в данном поле должно совпадать с кодом ФР, указанным в соответствующей карточке принтера, и не должно пересекаться с кодами ФР, используемых в карточках фискальных регистраторов для разделения чеков по фискальным регистраторам.

При печати марок в открытом чеке и при наличии позиций, принадлежащих к разным группам печати марок, печать будет разделена на отдельные задания, разделенные по кодам оборудования и каждое задание будет отправлено на свой принтер.

# Настройка шаблонов марок

Для настройки содержимого, печатаемого в марках на принтеры в карточках оборудования для принтеров чеков присутствует функционал указания выражений для строк, заголовка и подвала чека.

![2024-11-26_16-56-01.png](/images/integrations/chequeprinter/2024-11-26_16-56-01.png)

Обработка строк шаблонов происходит с учетом символов переноса строк, т.е. каждая строка в шаблоне будет выведена как отдельная строка на марке.
Так же к печатаемым строкам может быть применено форматирование, поддерживаемое драйвером принтеров чеков Атол.
Шаблон указания строки с форматированием следующий:
`"{Данные форматирования}" + ПечатаемаяСтрока`, где "{Данные форматирования}" это строка, содержащая свойства из драйвера принтера чеков, применяемых к строкам при печати, и их значения через знак равно. Если к строке применяется несколько параметров, то эти параметры со значениями разделяются между собой знаком точки с запятой ";".

Пример шаблона для печати заголовка марок:
```js
REPLICATE("=",КОЛИЧЕСТВОСИМВОЛОВ) + 
"{Alignment=1;FontDblWidth=true;FontBold=true;FontDblHeight=true;}Принтер ""Кухня"". Марка № " + ALLTRIM( НОМЕР_ЧЕКА ) + 
"{Alignment=0;}Официант " + ОПЕРАТОР_ИМЯ + 
"{Alignment=0;}Номер стола " + НОМЕРСТОЛА + 
"{Alignment=0;}Количество гостей " + КОЛИЧЕСТВОГОСТЕЙ + 
"Дата: " + DTOC( ДАТА() ) + SPACE( КОЛИЧЕСТВОСИМВОЛОВ - 31 ) + "Время: " + RIGHT(TTOC(ДАТАВРЕМЯ()),8) + 
"{FontBold=true;}Наименование товаров" + SPACE(22) + "Кол-во" + 
"{FontBold=false;}" + REPLICATE( "=", КОЛИЧЕСТВОСИМВОЛОВ )
```

Разберем построчно этот пример:
1. `REPLICATE("=",КОЛИЧЕСТВОСИМВОЛОВ)` - выведет строку, состоящую из знаков "=" в количестве, указанном в переменной КОЛИЧЕСТВОСИМВОЛОВ. Значение переменной КОЛИЧЕСТВОСИМВОЛОВ автоматически определяется из драйвера принтера чеков. При корректном возврате драйвера количества символов в строке знак "=" будет выведен на всю строку.

2. `"{Alignment=1;FontDblWidth=true;FontBold=true;FontDblHeight=true;}Принтер ""Кухня"". Марка № " + ALLTRIM( НОМЕР_ЧЕКА ) +` - выведет строку "Принтер "Кухня. Марка № 1". К строке применятся параметры: Выравнивание (Alignment) - по центру (значение 1), Удвоение ширины шрифта (FontDblWidth), Жирный шрифт (FontBold), Удвоение высоты шрифта (FontDblHeight)

3. `"{Alignment=0;}Официант " + ОПЕРАТОР_ИМЯ +` - выведет строку "Официант Иванова М.И.". К строке применит параметры: Выравнивание (Alignment) - слева (значение 0).

4. `"{Alignment=0;}Номер стола " + НОМЕРСТОЛА + ` - выведет указанный номер стола (если подключен [Информер](#Подключение_обработчика_для_запроса_произвольных_данных) ). Выравнивание строки будет слева, т.к. применен параметр Alignment со значением 0.

5. `"{Alignment=0;}Количество гостей " + КОЛИЧЕСТВОГОСТЕЙ +` - выведет указанное количество гостей (если подключен [Информер](#Подключение_обработчика_для_запроса_произвольных_данных) ). Выравнивание строки будет слева, т.к. применен параметр Alignment со значением 0.

6. `"Дата: " + DTOC( ДАТА() ) + SPACE( КОЛИЧЕСТВОСИМВОЛОВ - 31 ) + "Время: " + RIGHT(TTOC(ДАТАВРЕМЯ()),8) + ` - будет выведена строка с датой и временем, разнесенные по ширине. Параметров к этой строке никаких не применяется, поэтому строка будет напечатана обычным шрифтом.

7. `"{FontBold=true;}Наименование товаров" + SPACE(22) + "Кол-во" + ` - будет выведена строка заголовка, перед выводом позиций. Строка будет напечатана жирным шрифтом, т.к. для параметра FontBold установлено значение true.

8. `"{FontBold=false;}" + REPLICATE( "=", КОЛИЧЕСТВОСИМВОЛОВ )` - выведет еще один разделитель из знаков "=" как и в начале марки. Здесь принудительно сбрасывается значение свойства FontBold в значение false, чтобы не применилась установка признака жирного шрифта из предыдущей строки.
