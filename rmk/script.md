---
title: Полезные скрипты для РМК
description: Различные дополнительные скрипты для расширения функционала
published: true
date: 2023-11-20T11:57:52.473Z
tags: рмк, дополнения
editor: markdown
dateCreated: 2023-11-13T12:55:34.447Z
---

# Запрет продажи товара в минус
В стандартном функционале РМК присутствует возможность скрытия из визуального поиска товаров с нулевым или отрицательным остатков. Но при этом сама продажа таких товаров не блокируется, если товар добавили в чек по штрихкоду. Если нужно все же заблокировать продажу товаров без остатка, то в карточке схемы РМК на вкладке "ЕГАИС и скрипты" в скрипт "Проверка возможности продажи товара" нужно добавить следующий скрипт:
```js
Остаток	= ЗАПРОС( "SELECT dbo.fn_calcsklad( '" + @Товар + "', '', '', '001', '' )" );
IF ( Остаток <= 0 )
{
	СООБЩЕНИЕ( "На складе не хватает остатка товаров для продажи" );
   	RETURN false;
}
RETURN true;
```
![2023-11-13_15-52-56.png](/images/rmk/ext/2023-11-13_15-52-56.png){.align-center}

# Запрет использования оплаты "Сертификатом" без ввода сертификата
При работе с подарочными картами ввод оплаты сертификатом поумолчанию доступен и без ввода подарочного сертификата. Реализована это для поддержки бумажных сертификатов совместно с электронными. Чтобы запретить использование бумажных сертификатов и оплаты Сертификатом без ввода электронного сертификата необходимо в схеме РМК в скрипт "Проверки перед записью чека" добавить следующий скрипт: 
```js
IF ( ВСЕГОСЕРТИФИКАТЫ <> 0 ) 
{
	нпп = 0;
	_ЕСТЬСЕРТИФИКАТ = false;			
	WHILE ( нпп < КОЛИЧЕСТВОПЛАТЁЖНЫХКАРТ )
	{
		_ЕСТЬСЕРТИФИКАТ = ЗАПРОС("SELECT cardkind FROM sprmcard WHERE cardn = '" + ПЛАТЁЖНЫЕКАРТЫ[ нпп ] + "'") == 1;
		IF ( _ЕСТЬСЕРТИФИКАТ ) BREAK;			
		нпп++;
	}
	
	IF ( !_ЕСТЬСЕРТИФИКАТ )
	{
		СООБЩЕНИЕ("Запрещено закрывать чек с видом оплаты ""Сертификатом"" без ввода подарочной карты","ВНИМАНИЕ!");
		RETURN false;
	}		
}
RETURN true;
```
![2023-11-13_16-01-55.png](/images/rmk/ext/2023-11-13_16-01-55.png){.align-center}

# Отлючение печати фискальных чеков для "Прочих документов"
> Функционал автоматической установки свойства "ЭтоТоварныйЧек" в зависимости от типа создаваемого документа доступен начиная с версии **РМК 4.5.4**.
{.is-warning}

В РМК доступен функционал формирования различных типов документов при оформлении продаж, таких как "Расходная накладная", "Инвентаризация", "Списание" и прочие.
Выбор типа документа осуществляется в Параметрах чека.
![2023-11-13_16-10-57.png](/images/rmk/ext/2023-11-13_16-10-57.png){.align-center}

По умолчанию для всех чеков устанавливается тип **"Документ кассовой смены"** и все чеки фискализируются на подключенной ККТ. Для остальных типов документов, за исключение "Вскрытие тары" так же происходит фискализация чека на подключенной ККТ. Чтобы отключить фискализацию для всех прочих документов, необходимо создать дополнительное свойство чека **"ЭтоТоварныйЧек"** и добавить его в список дополнительных свойств чека в рабочей схеме РМК.
![2023-11-13_13-59-28.png](/images/rmk/ext/2023-11-13_13-59-28.png){.align-center}

Далее в схеме РМК на вкладке "ЕГАИС и скрипты" в скрипт проверки перед записью чека необходимо вставить следующий скрипт:
```js
//получим значение в поле с типом документа
ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕПОЛУЧИТЬЗНАЧЕНИЕПОЛЯ, "doccode");
КодДокумента = _ЗНАЧЕНИЕПОЛЯ;
//если выбрана 002 - Расходная накладная, 003 - Списание, 007 - Инвентаризация, 020 - Заказ от покупателя,
//то производим действия по установке признака ЭтоТоварныйЧек и, при необходимости, признака формирования отдельного документа
IF ( ВСПИСКЕ( КодДокумента, "002", "003", "007", "020" ) )
{
	//установка признака товарного чека (для печати нефискального чека)
	ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕУСТАНОВИТЬЗНАЧЕНИЕПОЛЯ, "ЭтоТоварныйЧек", true);
	//установка текста в 5й строке
	ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕУСТАНОВИТЬЗНАЧЕНИЕПОЛЯ, "pextextview", "ТОВАРНЫЙ ЧЕК");
	//установка признака формирования отдельного документа
	ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕУСТАНОВИТЬЗНАЧЕНИЕПОЛЯ, "separetedoc", true); 
}
ELSE
{
	//в иных случаях устанавливаем стандартные значения
	ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕУСТАНОВИТЬЗНАЧЕНИЕПОЛЯ, "ЭтоТоварныйЧек", false);
	ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕУСТАНОВИТЬЗНАЧЕНИЕПОЛЯ, "separetedoc", false);
	ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕУСТАНОВИТЬЗНАЧЕНИЕПОЛЯ, "pextextview", "ФИСКАЛЬНЫЙ ЧЕК");
}
RETURN true;
```
![2023-11-13_16-19-47.png](/images/rmk/ext/2023-11-13_16-19-47.png){.align-center}

# Отключение печати бумажных чеков
> **Внимание! Согласно 54-ФЗ покупателю должен быть выдан бумажный кассовый чек, либо отправлен электронный кассовый чек в виде ссылки в смс на указанный номер телефона или на указанную электронную почту покупателя.
Использование указанного ниже скрипта подразумевается только для целей отладки или тестирования пробития чеков с целью экономии чековой ленты при таком тестировании.
Ответственность за несоблюдений требований 54-ФЗ лежит на владельце контрольно кассовой техники.**
{.is-warning}

Для отключения печати кассовых чеков в РМК необходимо в рабочей схеме(схемах) РМК на вкладке "ЕГАИС и скрипты" в скрипт проверки перед записью чека добавить следующий скрипт:
```js
IF ( СООБЩЕНИЕ("Напечатать бумажный чек ", "Экономим ленту", 4 ) <> 6 ) {
	ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕУСТАНОВИТЬЗНАЧЕНИЕПОЛЯ, "echeque", true );
	ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕУСТАНОВИТЬЗНАЧЕНИЕПОЛЯ, "telemail", "mail@mail.ru" );
}

RETURN true;
```
где вместо `mail@mail.ru` необходимо указать адрес электронной почты, на который нужно отправлять пробиваемые электронные чеки.
![2023-11-13_16-28-38.png](/images/rmk/ext/2023-11-13_16-28-38.png){.align-center}