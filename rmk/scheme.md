---
title: Схемы рабочих мест
description: Айтида РМК
published: true
date: 2025-03-03T09:56:31.199Z
tags: рабочие места, схема рмк
editor: markdown
dateCreated: 2022-08-14T21:09:43.074Z
---

В справочнике схем РМК необходимо создать как минимум одну схему для работы с МРП v.2. Схема содержит описание правил работы РМК.

# Закладка РМК/Кассиры

На первой закладке необходимо определить список рабочих мест используя кнопки **Добавить** и **Удалить** рабочее место. Кнопка **Изменить название РМК** позволяет изменить название рабочего места без изменения других настроек.

## Закладка общая информация.

![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/e3aee574d1d92ea4570865320f6c0efe.png)

На закладке **Общая информация** три раздела.

1.  **Склады для расчета**. Позволяет указать списки складов для расчета:
    - **Остатков**. В подвале чека и в окне подбора товаров будет выводиться суммарный остаток для выбранных складов. Если поле оставить пустым, то оно не будет использоваться, а остаток будет рассчитываться для склада, указанного для расчета цены продажи.
    - **Цены**. Цена продажи для рабочего места будет рассчитываться исходя из категории, указанной на выбранном складе. Поле должно быть заполнено.
    - **Доступные**. Если в поле выбраны значения, то функция просмотра остатков будет использовать только выбранные значения, для отображения остатков на складах. Если поле оставить пустым, то будут выводиться остатки на всех доступных складах.
2.  **Узел обмена**. При использовании распределенной базы в этом разделе необходимо выбрать узел обмена, в котором находится рабочее место. Если поле оставить пустым, то значение можно будет указать в параметрах РМК. Остальные поля раздела информационные и отражают текущую версию базы данных в узле и время последнего обмена данными.
3.  **Время работы**. Позволяет задать время работы рабочего места кассира. Значения можно использовать, например, для применения скидок вида «за час до закрытия» и т. п. образом. Пример скидки, использующей эту информацию:

    ![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/7c0afae80b734129700d9fc7d9a5a1c5.png)

```js
RETURN ЕСЛИ( _ВРЕМЯЗАКРЫТИЯ_ЧАС - ЧАС( ДАТАВРЕМЯ( ) ) <= 1, 30, 0 );
```

| Переменная             | Значение                                                 |
|------------------------|----------------------------------------------------------|
| \_ВРЕМЯЗАКРЫТИЯ_ЧАС    | Номер час, указанный в поле Время работы / Окончание.    |
| \_ВРЕМЯЗАКРЫТИЯ_МИНУТА | Номер минуты, указанный в поле Время работы / Окончание. |
| \_ВРЕМЯОТКРЫТИЯ_ЧАС    | Номер час, указанный в поле Время работы / Начало.       |
| \_ВРЕМЯОТКРЫТИЯ_МИНУТА | Номер минуты, указанный в поле Время работы / Начало.    |

4.  **План меню**. Признак предназначен для торговли на предприятиях общественного питания. Если установлен признак, то при продаже будет контролироваться список товаров, доступных к продаже. Список задается документами План-меню. В документе План меню может быть задан список продаваемых блюд и время действия списка. Документов План меню может быть несколько.
    1.  Можно сформировать списки на каждый день недели.
    2.  На определенное время каждого дня недели.
    3.  На период, с указание даты и времени действия.

    Если в один момент будет несколько действующих планов меню, то они будут объединены в единый список. План меню должен быть записан и проведен.

    ![](/images/rmk/scheme/e51b0fc401b834d9cad809bdd6f095a6.png)

    Если включена работа с планами меню, то при подборе товара, в случае, если товар запрещен к продаже, будет выведено сообщение **Продажа выбранного товара в данный момент не разрешена**.

## Закладка Сотрудники.

![](/images/rmk/scheme/5b9b89c3737649acf8d9abf89ddf88ff.png)

На закладке **Кассиры** можно сформировать список кассиров, которые имеют право работать на выбранном рабочем месте. Если список будет содержать один и более элементов, то только выбранные кассиры смогут запустить МРП v.2 от своего имени. Если список будет пустой, то все определенные в системе сотрудники с уникальными паролями смогут запускать МРП v.2 от своего имени.

## Закладка Менеджеры.

![](/images/rmk/scheme/c5fd10f24e8d635fc1895ba8730d3e69.png)

На закладке **Менеджеры** можно сформировать список сотрудников, которые смогут быть выбраны в чеке в качестве ответственных менеджеров. Это позволит в будущем формировать отчеты о продажах сотрудниками.

## Закладка Оборудование.

![](/images/rmk/scheme/b90ada9dbf544dc37a22adeb6fa7f5c5.png)

На закладке оборудование необходимо сформировать список торгового оборудования, используемого на рабочем месте. В качестве такого могут быть ККТ (оборудование с типом ФР), весы без печати этикеток, платежные системы и прочее оборудование. ККТ, платежных систем и прочего оборудования может быть добавлено в список несколько. При добавлении нескольких ККТ в список будет возможность деления одного чека на несколько печатных устройств. Весы могут быть только одни. При добавлении нескольких платежных систем будет возможность указывать суммы оплаты чеков для каждой платежной системы отдельно. Платежная система будет обрабатывать указанные для нее суммы самостоятельно, посредством профиля платежных систем. Если в списке не будет указана ПС для какого-либо вида оплаты, то будет задействована встроенная платежная система без дополнительного функционала, т. е. без ограничения сумм оплаты и без какого-либо взаимодействия с оборудованием.

Если в списке нет весов, то функционал чтения веса с весов будет недоступен.

# Закладка Товары/Услуги.

На закладке Товары/Услуги необходимо сформировать список товаров, которые будут представлены в блоке кнопок для быстрого выбора.

![Панель товаров](/images/rmk/scheme/55afc228cfcaa4860a7794e59d5ca49f.png)

![Настройка панели товаров](/images/rmk/scheme/3a3c24ae79859df4be8521a9c20382ce.png)

В список могут быть добавлены отдельные товары/услуги, папки товаров/услуг и группы ресурсов, а так же содержимое активного плана меню. В результате из полученного списка будет сформирован линейный или иерархический (зависит от значения параметра **Выводить папки**) список товаров и именно он будет отображен в панели быстрого выбора. Для товаров/услуг в панели быстрого доступа будет выведено краткое наименование из карточки товара или услуги. Для папок будет выведен текст из колонки **Текст**. Для выбранных товаров/услуг можно задать комментарий, который будет выводиться при выборе такого товара. Если данные параметры не будут заданы в схеме, то при работе будут выводиться соответствующие значения из карточки товара.

Порядок товаров в панели выбора будет соответствовать порядку строк в списке. Для плана меню порядок определяется в самом документе нумерацией строк в колонке **№ п/п**. Если в список добавлено содержимое плана меню, то на панели быстрого доступа будет выведено сначала все позиции до этого пункта, потом содержимое плана меню в порядке указанном в документе, затем остальные строки из списка.

Установка признака **Выводить папки** укажет системе, что не нужно сразу формировать весь список товаров, входящих в выбранные папки, а нужно выводить названия самих папок, для того, чтобы кассир мог заходить в них и внутри выбирать товары.

![Изображение выглядит как стол Автоматически созданное описание](/images/rmk/scheme/4a4099ccc8490e14c9dcbfa2a5d7e0c1.png)

Внутри папок список товаров содержит все товары папки и ограничивается параметрами «**Не показывать товары без цены»**, «**Не показывать товары без остатка»**, «**Неиспользуемые карточки»**. В качестве порядка сортировки для товаров внутри папки используется название товаров.

# Закладка Клавиатура/меню.

#### Клавиатурные функции.

![](/images/rmk/scheme/977f41d55f36dc10e3c1ce7b750d91ff.png)

Позволяет расширить / изменить комбинации клавиш для выполнения различных функций МРП2. Так же позволяет добавить кнопки с выполняемыми командами в панель кнопок РМК. Список допустимых команд охватывает практически все возможные операции, допустимые в МРП2. С выбранной клавишей могут быть использованы модификаторы <kbd>SHIFT</kbd>/<kbd>CTRL</kbd>/<kbd>ALT</kbd>. Недопустимыми являются комбинации, зарезервированные операционной системой под свои нужды. Например, <kbd>ALT</kbd>+<kbd>TAB</kbd>. Если для какой-то функции не задана комбинация, то будет использоваться стандартная, аналогичная МРП1:

![Изображение выглядит как текст, стол Автоматически созданное описание](/images/rmk/scheme/80a69f0b6ed1c532266955f305517b1a.png)

Меню кнопки ![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/c4c52d0f3da8da56e5e837fee30fab3b.png) позволяет добавить в список новую клавиатурную функцию либо загрузить список функций из другой схемы РМК.

Меню кнопки ![](/images/rmk/scheme/079e4dd4cec166d4dc4727c7b8e89aa3.png) позволяет удалить из списка клавиатурную функцию либо очистить весь список.

В качестве клавиатурной функции может быть задан скрипт, выполняющий какую-либо работу. Например, для добавления конкретного товара может быть задан такой скрипт

```js
ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕВЫПОЛНИТЬКОМАНДУ, "ДОБАВИТЬТОВАРПОАРТИКУЛУ", "22357" )
```

Вместо *ДОБАВИТЬТОВАРПОАРТИКУЛУ* могут быть указаны такие команды:

-   ДОБАВИТЬТОВАРПОКОДУ;
-   ДОБАВИТЬТОВАРПОАРТИКУЛУ;
-   ДОБАВИТЬТОВАРПОШК;
-   ДОБАВИТЬТОВАРПОНАЗВАНИЮ;
-   ДОБАВИТЬТОВАРПОВНУТРЕННЕМУКОДУ.

    Полный список допустимых команд приведен в [Таблице 2](/rmk/variables#Таблица2).    

Клавиатурная функция может иметь параметр. Правее поля **Команда** расположено поле для ввода или просмотра выражения, вычисленное значение которого, будет служить параметром клавиатурной функции. Параметры вычисляются в момент запуска приложения, поэтому могут обращаться только к статическим переменным из [таблицы 6](/rmk/variables#Таблица6).

Поле ШК позволяет задать штриховой код для выполняемой функций. В таком случае, чтением сканером такого штрихового кода приведет к исполнению функции. Штриховой код может быть удобен в случае отсутствия на рабочем месте клавиатуры. Тогда связь штриховых кодов с функциями может облегчить кассиру доступ к часто используемому функционалу.

Кнопка ![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/45990593ff11751ebc27ed50f0bf8ab3.png)позволяет сгенерировать правильный EAN13 из неиспользуемого диапазона штриховых кодов. В кнопке **Печать** можно выбрать печатную форму для вывода списка ШК на печать.

Кнопка «**Настройка кнопки»** позволяет дополнить комбинацию визуальной кнопкой на панели задач РМК. В описании кнопки можно указать её текст, цвет фона, цвет текста и шрифт.

![](/images/rmk/scheme/94810f9be089e32bca1d14880465898a.png)

Если указан не пустой текст кнопки, то кнопка будет выведена на панели кнопок. Иначе не будет. Цвета фона и текста указываются в шестнадцатеричном виде с символом **\#** в начале.

Формат описания шрифта следующий: Имя шрифта, Размер в точках, Толщина, Наклонность, Подчеркнутость. Например: courier,14,1,0,0

![](/images/rmk/scheme/b37515cafe6d3140649f67e205a3c287.png)

#### Настройка основного меню.

![](/images/rmk/scheme/3b591235e6bf766c0e8b49f4849695cd.png)

Список пунктов меню может быть линейным или иерархическим. Над списком расположены кнопки:

1.  перемещение выбранного пункта меню вверх в пределах родителя;
2.  перемещение выбранного пункта меню вниз в пределах родителя;
3.  добавление нового пункта меню дочерним к текущему выбранному;
4.  удаление выбранного пункта меню.

При добавлении дочерних пунктов, родительский пункт перестает выполнять указанные в нем команды, а становится заголовком для вложенных пунктов. Связанные с пунктом меню команды, параметры и скрипты полностью аналогичны клавиатурным функциям описанным выше.

![](/images/rmk/scheme/613dd72076a824597283d0a533c63753.png)

Меню доступно в случае наличия заголовка у главного окна приложения (см. [Прочее/Интерфейс](#интерфейс)).

# Закладка Печать / Операции.

## Операции.

![Изображение выглядит как стол Автоматически созданное описание](/images/rmk/scheme/4e69cbe510de38b671ea212f1bb7d192.png)

В разделе операций можно задать права на формируемые типы чеков, виды оплаты и основные функции. Варианты выбора следующие:

1.  **Д** - доступно – доступно кассирам и администратору;
2.  **А** - доступно администратору, т. е. доступно только администратору, но не кассиру;
3.  **К** – доступно только с клавиатуры, а элемента в интерфейсе нет;
4.  **Н** – никому недоступно.
5.  **И** – для разрешенных действий. предписывает записывать информацию о выполнении функции.

Отличия между кассиром и администратором - в профиле, который задается в карточке сотрудника. Значения от 1 до 28 считаются кассирами. Значения 29 и 30 – администраторами.

## Запись истории действий пользователя.

В списке сервисных функций доступна колонка **И**

![](/images/rmk/scheme/c9da7a47b597031882a37df8739f2d7d.png).

Установка признака в этой колонке укажет программе на необходимость записи истории применения кассиром соответствующей функции. Запись производится в таблицу **chequehistory**.

Таблица **chequehistory** содержит следующие поля.

| **Имя поля**  | **Тип данных**      | **Комментарий** |
|---------------|---------------------|-------------------|
| date          | Дата и время        | Дата и время выполнения функции. |
| rmkschem      | Строка 10 символов  | Код схемы РМК, указанный в настройках РМК. |
| rmk           | Строка 10 символов  | Код РМК, указанный в настройках РМК.  |
| username      | Строка 250 символов | Имя кассира, авторизовавшегося на РМК на момент выполнения функции.  |
| usercode      | Строка 10 символов  | Код кассира из справочника сотрудников. |
| operation     | Число целое         | Код функции 1 – Загрузка отложенного чека; 2 – Сохранение отложенного чека; 3 – Отмена чека; 4 – Возврат по чеку; 5 – Выбор операции (продажа, возврат и т. п.); 6 – Закрытие смены; 7 – Открытие смены; 8 – Выбор менеджера; 9 – Внесение наличных в кассу; 10 – Выплата наличных из кассы: 11 – Вызов параметров программы; 12 – Вызов параметров чека; 13 – Свободная продажа; 14 – Печать копии чека; 15 – Изменение цены продажи; 16 – Изменение количества; 17 – Удаление строки чека; 18 – Применение ручной скидки; 19 – Применение автоматической скидки; 20 – Печать прочих форм; 23 – Выбор категории цены чека; 24 – Выбор единицы измерения; |
| operationname | Строка 250 символов | Текстовое название операции. |
| object        | Строка 250 символов | Для перечисленных операций записываются следующие значения: 2 – ИД отложенного чека; 4 – ИД чека, по которому производится возврат; 5 – Выбранная операция (число от 1 до 5); 8 – Код из справочника сотрудников; 9 – Сумма внесенных наличных; 10 – Сумма выплаченных наличных; 13 – Строка, содержащая название, количество и цену; 14 – ИД чека, копия которого выведена на печать; 15 – Номер строки чека, в которой изменена цена; 16 – Номер строки чека, в которой изменено количество; 17 – Номер удаляемой строки чека; 18 – Код примененной скидки, либо процент/сумма; 19 – Номер дисконтной карты; 20 – Код печатной формы; 23 – Выбранная категория цены чека; 24 – Выбранная единица измерения; |
| before\_      | Текст               | Чек в формате Json до примененной операции. Записывается для функций: 2, 3, 5, 12, 13, 15, 16, 17, 18, 19, 23, 24 |
| after\_       | Текст               | Чек в формате Json после примененной операции. Записывается для функций: 1, 5, 12, 13, 15, 16, 17, 18, 19, 23, 24 |

## Печать.

![](/images/rmk/scheme/a9bf55f42d571d32f2620fe827836e08.png)

Параметры печати позволяют задать печатные формы, которые будут формироваться в соответствующие моменты времени. Печатные формы могут быть выведены на любой принтер, работающий через стандартную системную очередь печати. Печать будет производиться на указанный принтер. Если имя принтера не указано или указано неверно, то печать будет произведена на принтер по умолчанию.

Печатная форма чека вызывается один раз на всю регистрации после формирования и записи чека в базу данных. Например, можно автоматически печать товарный чек или накладную, гарантийные талоны и иные сопроводительные документы.

Печатная форма для копии чека формируется при печати копии чека. Это может быть та же форма, что и для чека, либо иная, с пометкой, что это копия.

Печатная форма для z-отчета формируется после закрытия смены и формирования z-отчета. Печатная форма формируется для каждого ФР отдельно.

В нижний список могут быть добавлены печатные формы, которые кассир сможет распечатать из панели **Сервис/Печать прочая**. Либо, использовав клавиатурную функцию. Эти формы выводятся на принтер по умолчанию.

## Закладка Доп. свойства.

![Изображение выглядит как стол Автоматически созданное описание](/images/rmk/scheme/651a4a8db1576c9b1e01bef009feafd8.png)

На закладке **Дополнительные свойства** можно определить, какая дополнительная информация будет связана с чеком. **Дополнительные свойства –** это поля с данными, которые могут быть заполнены автоматически скриптами или кассирами в визуальном режиме. Например, если на кассе возможно оформление заказа с доставкой, то может быть запрошен признак наличия доставки и адрес доставки. Введенная информация будет сохранена вместе с чеком и распечатана на бланке заказа или в самом чеке.

**Дополнительные свойства** могут быть привязаны к чеку целиком, либо к каждой строке чека.

Добавление свойств производится из справочника **Параметров системы**. Это позволяет организовать не только ввод текстовых данных, но и выбор значений из предопределенного списка/справочника.

Дополнительные параметры могут быть запрошены автоматически. Для чека – в момент добавления первого товара в чек (маркер в колонке **До**) и/или перед печатью чека (маркер в колонке **Оп**).

![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/d6a0926768333328712fd18041b057db.png)

Для строки чека параметры могут быть запрошены автоматически при добавлении строки в чек. Так же, если для строки чека определены дополнительные свойства, то в контекстом меню строки чека будет доступен пункт ввода значений.

![](/images/rmk/scheme/614e4a07a783f6039ef4801e2f55ca53.png)

Для запроса дополнительных свойств чека и свойств строки предусмотрены клавиатурные функции.

## Модификаторы.

Если для продаваемого товара в карточке товара определены модификаторы, то они могут быть запрошены и сохранены со строкой чека.

При наличии модификаторов в контекстном меню строки чека будет пункт для их ввода.

![](/images/rmk/scheme/23cc4e11883045cd60415ecdbdfba055.png)

Выбор пункта меню откроет окно для выбора модификаторов позиции чека.

![](/images/rmk/scheme/976195b8ff9b252f8cf2158f7cfe2ebb.png)

Количество может быть как целым, так и дробным. Ввод возможен как с клавиатуры, так и экранными кнопками. Для запроса модификаторов предусмотрена клавиатурная функция.

Если в группе модификаторов указано, что все модификаторы из группы должны автоматически подбираться в чек, то при выборе товара, все модификаторы автоматически подберутся в чек. Если у кассира будут права на работу с модификаторами, то он сможет изменить их состав. Если разрешен только один модификатор из группы, то будет возможен выбор только одно модификатора из группы.

![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/c9fff8aea7b9db8ef1439b0978ff7445.png)

![](/images/rmk/scheme/7e32f50f5d90ae5ec80bb34b01098c46.png)

# Закладка ЕГАИС/ ГИИС ДМДК и скрипты.

![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/7d292654ccdef98d9a888610cc61e990.png)

Скрипты позволяют выполнить более тонкую настройку работы МРП v.2. Каждый скрипт представляет собой программу, написанную на языке вычислений Айтида. Ознакомиться с правилами написания программ и возможностями языка можно в [документации](https://itida.ru/download/docs/short_manual_itida_lang.pdf). Каждый скрипт выполняется в окружении, формируемом переменными, значения которых задаются самим МРП2, а так же из собственных переменных скрипта. Собственный контекст скриптов очищается при формировании нового чека. Для сохранения значений переменных между чеками необходимо объявлять такие переменные в ключевом слове PUBLIC.

Возможности используемого языка расширяются дополнительными командами, которые может выполнять МРП2, по запросу скрипта. Для выполнения таких запросов предусмотрена функция:

```js
Сервис.РМКВыполнитьКоманду( Команда, Параметр1, Параметр2 );
```

Например,

```js
Сервис.РМКВыполнитьКоманду( “ИНФОРМАЦИЯОТОВАРАХ”, @Товар );
```

Команда – это строка, имеющая одно из допустимых значений (см. [таблицу допустимые команды](/rmk/variables#Таблица2)). Параметр1 и Параметр2 – параметры команды, зависящие от самой команды.

Кроме собственных переменных, скрипты могут использовать в своей работе переменные, определяемые МРП2. Списки и описание таких переменных приведены в [Приложении](/rmk/variables) в [таблицах 6-12](/rmk/variables#Таблица6).

Скрипт **Создание нового чека** вызывается каждый раз, когда создается новый чек. Это происходит при запуске приложения, после закрытия чека и очистки всего контекста, связанного с закрытым чеком, при отмене чека. Пример скрипта.

![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/9af552f1be32e22c49e2ea83c0312db2.png)

```js
ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕУСТАНОВИТЬЗНАЧЕНИЕПОЛЯ, "pextextview", "ЧЕК НЕ ОТКРЫТ" );
```

Скрипт **Проверка перед записью** чека вызывается в момент формирования чека сразу после записи в базу данных, но перед выводом на ККТ. Вызов производится внутри транзакции записи чека. Поэтому, выполнение скрипта не должно занимать много времени. Иначе, могут возникнуть задержки и ожидания в параллельно работающих рабочих местах, подключенных к одной базе данных. Скрипт должен вернуть **Истину**, если проверка прошла успешно. Если скрипт вернет **Ложь**, то чек будет отменен и удален из базы данных. Пример скрипта.

![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/ac691c5dc0248c66e2be856c6e9afc44.png)

```js
ДОБАВИТЬКОНТЕКСТ( "SELECT name, maincode, remainder 
		    						FROM sprres 
		   						INNER JOIN ( SELECT spec.nn, dbo.fn_calcremainder_fr_delayed( spec.nn, CASE WHEN schem.skladrmd = '' 
																THEN schem.sklad ELSE schem.skladrmd END, '001' ) AS remainder
																FROM chequespec spec 
																INNER JOIN specrmkschem schem ON schem.code = '0000000001'
																WHERE dbo.fn_calcremainder_fr_delayed( spec.nn, 
                                                                CASE WHEN schem.skladrmd = '' THEN schem.sklad ELSE schem.skladrmd END, '001' ) < 0 AND
                                			spec.ic = " + ИДОбъекта + " ) AS remainders ON sprres.code = remainders.nn", "СписокТоваров", 1 );
СтрокаСообщения		= "";
WHILE ( !КОНЕЦКОНТЕКСТА( "СписокТоваров" ) )
{
	СтрокаСообщения	= CHR( 13 ) + СписокТоваров.maincode + " " + СписокТоваров.name + " = " + STR( СписокТоваров.remainder, 16, 2 );
	ПРОПУСТИТЬ( 1, "СписокТоваров" );
}
УДАЛИТЬКОНТЕКСТ( "СписокТоваров" );
IF ( !ПУСТО( СтрокаСообщения ) ) СООБЩЕНИЕ( "Для товаров получился отрицательный остаток:" + СтрокаСообщения );
RETURN true;
```

Скрипт **Пост обработка чека** вызывается после закрытия или аннулирования каждого под-чека. При успешном закрытии под-чека в переменной **ИДЧека** будет идентификатор (число целое) чека. В случае отмены (аннулирования из-за ошибок) значение **ИДЧека** будет равно нулю.

Скрипт **Пересчет строк чека** вызывается при необходимости получить остаток и/или учетную цену товара для строки чека. Относительно учетной цены товара производится расчет скидок. Остаток выводится в подвале чека.

Скрипт **Проверка значений и прав доступа** вызывается при изменении любых параметров чека и нажатии кнопок на панелях. В переменной **\_ИМЯПОЛЯ** передается имя (латинскими строчными буквами) измененного поля в чеке или строке чека, или название нажатой кнопки. Список возможных значений приведен в [таблице 13](/rmk/variables#Таблица13).

Для всех полей, кроме **ware** и **chequepex** действуют следующие правила.

1.  В переменной **\_ЗНАЧЕНИЕПОЛЯ** передается новое значение поля.
2.  Скрипт должен вернуть Истину, если изменение разрешено. Иначе – Ложь. Если скрипт вернет Ложь, то изменение будет отклонено и у поля останется прежнее значение.
3.  Если скрипт не пустой, то его последней строкой обязательно должна быть команда **RETURN true;**

Для вариантов **ware** и **chequpex** выполнение скрипта производится после добавления товара/ввода значений дополнительных свойств. Возвращаемое скриптом значение игнорируется. Это связано с тем, что для этих вариантов предусмотрены собственные отдельные скрипты проверки значений (**Скрипт проверки возможности продажи товара** и **Скрипт проверки введенных значений дополнительных свойств**).

![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/4ff2578b73ec3646807d9eb2662e65cd.png)

```js
IF ( _ИМЯПОЛЯ  == "quantity" )
{
     ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕПОЛУЧИТЬЗНАЧЕНИЕПОЛЯВСТРОКЕ, "kolp" );
     IF ( kolp <= 0 )
        ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕВЫПОЛНИТЬКОМАНДУ, "DELLINE" );
}
	
IF ( UPPER( ALLTRIM( _ИМЯПОЛЯ ) ) == "OPENCHEQUE" )
{
    Доставка		= СООБЩЕНИЕ( "Заказ на доставку?", "Заказ на доставку", 4 ) == 6;
    Место			= СООБЩЕНИЕ( "Заказ с собой?", "Заказ с собой", 4 ) == 6;

    ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕУСТАНОВИТЬЗНАЧЕНИЕПОЛЯ, "Доставка", Доставка);
    ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕУСТАНОВИТЬЗНАЧЕНИЕПОЛЯ, "Место", Место );
}

IF ( _ИМЯПОЛЯ == "opencheque" || _ИМЯПОЛЯ == "chequepex" )
     ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕУСТАНОВИТЬЗНАЧЕНИЕПОЛЯ, "pextextview", 
                                                     ЕСЛИ( Доставка, "ДОСТАВКА", "КАФЕ" ) + ЕСЛИ( Место, " / С СОБОЙ", "" ) );
	
IF ( _ИМЯПОЛЯ == "ware"  )
{
	Товар		= ЗАПРОС( "SELECT TOP 1 subcode FROM DopSales WHERE code = '" + maincode + "'" );
	If( !ПУСТО( Товар ) )
	     ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕВЫПОЛНИТЬКОМАНДУ, "ДОБАВИТЬТОВАРПОКОДУ", Товар );
}
RETURN true;	
```

Скрипт **Проверка возможности продажи товара** вызывается при подборе товара в чек. Если скрипт вернет Ложь, то строка не будет добавлена в чек.

![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/ddcbf11526d7cde01bfb68ec5b03fe76.png)

```js
IF ( ЗАПРОС( "SELECT CASE WHEN EXISTS( SELECT * FROM reg001 WHERE nn = '" + @Товар + "' AND code = '001' ) THEN 1 ELSE 0 END" ) == 0 ) 
{
	СООБЩЕНИЕ( "Нельзя продать товар, который не поступал на склад." );
	RETURN false;
}
RETURN true;
```

## Раздел для работы с ЕГАИС и ГИИС ДМДК.

![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/f574e20b0e9031e25a7fdddcaf069149.png)

![](/images/rmk/scheme/2be33c793acd7b3dc552c20b5e7996a2.png)

В разделе перечислены параметры, отвечающие за взаимодействие программы с ЕГАИС или ГИИС ДМДК.

Разделение алкогольных товаров. ювелирных изделий и прочих товаров производится скриптом **Выражение для определения типа товара**. Скрипт должен вернуть одно из значений:

- 0 – прочий товар, который не должен передаваться в транспортные модули ЕГАИС / ГИИС ДМДК.
- 1 – крепкий алкоголь, для которого необходимо требовать чтение марки, и который необходимо передавать в составе чека в ЕГАИС.
- 2 – пиво и слабоалкогольные напитки. Их не надо передавать в составе чека, но они являются алкогольными напитками и могут участвовать в установке на кран.
- 3 – ювелирные изделия. Для них нужно требовать чтение УИН и передавать в составе чека в ТМ ГИИС ДМДК.

    Стандартное выражение, определяющее тип товара на основании кода вида продукции и кода группы маркировки:

```js
RETURN ЗАПРОС( "SELECT dbo.fn_waretype( nnvid, markgroup ) FROM sprnn WHERE nn = '" + Товар + "'" );
```

При этом, если код вида продукции указан в карточке товара, то выражение вернет 1 или 2, в зависимости от значения кода. Если код вида продукции не указан, но выбрана группа маркировки Ювелирные изделия. То будет возвращено значение 3. В остальных случаях будет возвращено значение 0.

Для алкогольной продукции (тип товара 1 или 2) можно указать разрешенные часы продажи. При указании часов разрешенных, для продажи алкоголя, программа будет проверять продажу алкогольных товаров на попадание в указанный интервал времени. В случае выходя за рамки интервала будет выведено сообщение и товар не будет продан. Товар может быть уже в чеке (добавили ранее указанного в ограничении времени), но сформировать чек будет нельзя.

Бывают ситуации, когда нельзя указать единый временной интервал. В таких случаях моно использовать скрипт, который будет проверять текущую дату и время на предмет возможности продажи алкогольной продукции. Скрипт должен вернуть логическое значение:

- Истина – продажа разрешена.
- Ложь – запрещена.

Пример скрипта можно найти в библиотеке функций **Сервис** в функции **СкриптПроверкиОграниченияПродажиАлкоголя**

Контроль повторной продажи марок позволяет проверить продаваемые алкомарки и УИН на наличие их в более ранних продажах. Учитываются как продажи, так и возвраты марок.

**УТМ  ЕГАИС / ГИИС ДМДК для передачи чеков** определяет УТМ, в который будут отправляться чеки с крепким алкоголем. Для отправки чеков в ГИИС ДМДК необходимо настроить УТМ в модуле ЕГАИС Айтиды.

**Скрипт отправки данных чека в УТМ.** Для работы с ЕГАИС и ГИИС ДМДК скрипт должен содержать вызов процедуры отправки чека в УТМ.

Стандартный скрипт должен быть следующим.

```js
ЕГАИС.ОтправкаЧекаВЕГАИС( КОДУТМ, КОДОБОРУДОВАНИЯ, НОМЕРСМЕНЫ, НОМЕРЧЕКА, ИМЯТАБЛИЦЫ );
```

# Закладка Прочее.

![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/23a7fc210d7cd83551f681793d288ef5.png)

## Формирование документов.

В разделе **Формирование документов** задаются параметры документов, которые будут созданы в момент закрытия кассовой смены.

1. **Дата документа** – позволяет задать дату. С которой будут создаваться документы. Возможные варианты:
    - **Датой чеков** – из момента создания чека будет взята дата и с этой датой (концом дня) будут создаваться документы. Чеки с разными датами, но не временем, попадут в разные документы.
    - **Текущей датой** – все создаваемые документы будут текущей датой и временем. Все чеки не зависимо от момента их создания попадут в один документ.
    - **Датой закрытия смены** – все чеки будут поделены по сменам и документы будут созданы датой и временем транзакций закрытия смены.
2. **Группировать документы по кодам оборудования** – установка признака укажет системе, что чеки, пробитые на разных ФР, должны попасть в разные документы.
3. **Группировать документы по кассовым сменам** – установка признака укажет системе, что чеки из разных кассовых смен должны попасть в разные документы.
4. **Определить склад документа по группе товара –** для каждого проданного товара будет определяться склад из связанной группы ресурсов. Товары с разными складами попадут в разные документы.
5. **Определять фирму для документа по группе товара –** для каждого проданного товара будет определяться фирма из связанной группы ресурсов. Товары с разными фирмами попадут в разные документы.

По умолчанию в момент закрытия смены **Модуль регистрации продаж v.2** не формирует документов. Для того, чтобы модуль формировал документы по своим продажам необходимо убрать символы комментария в **Скрипте создания документов в момент закрытия смены**.

![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/b9a94bafe6f4fa97ee2af91d1fa43e1c.png)

## Закрытие смены и отложенные чеки.

В разделе можно выбрать варианты поведения системы в момент закрытия смены при наличии у кассира отложенных чеков.

Возможные варианты:

1. Ничего не делать. В момент закрытия смены не будет проверки на наличие отложенных чеков. Это значение по умолчанию.
2. Предупреждать о наличии. В этом случае в момент закрытия смены системы проверит наличие отложенных чеков и предупредит о них, если таковые есть. Кассир сможет отказаться принимать меры и закрыть смену.
3. Запретить закрывать смену при наличии. В этом случае в момент закрытия смены системы проверит наличие отложенных чеков и, если таковые есть, то не позволит кассиру закрыть смену. Кассир должен будет либо отменить все отложенные чеки, либо зарегистрировать их.

## Интерфейс.

![Настройки интерфейса](/images/rmk/scheme/7c5a451148b5c090fc8963b5ad58377f.png)

На закладке можно задать общие настройки интерфейса МРП2 и параметры формирования документов, в момент закрытия кассовой смены.

1. **Объединять строки с одним товаром в чеке** – параметр укажет системе, что при подборе товара, который уже есть в чеке, не будет добавляться новая строка. А будет увеличиваться количество в имеющейся.
2. **Панели быстрого доступа** – параметр укажет системе, что в правой части рабочего окна приложения будут выведены панели для быстрого доступа к основным функциям программы кнопки:
    - товарной матрицы;
    - сервисных функций;
    - параметров чека;
    - функциям скидок;
    - панели свободной продажи.

    Если параметр снят, то предполагается, что доступ ко всем функциям производится с клавиатуры.

3. **Сворачивать через … секунд**. Установка признака включит возможность сворачивания панелей быстрого доступа. При указании положительного интервала в секундах сворачивание будет производиться автоматически, через указанное количество секунд. Данная настройка может быть востребована при небольшом экране и большом значении масштаба интерфейса.
4. **Отображать панель с текущим товаром** – если установлен параметр, то над списком товаров будет выведена панель с товаром из текущей строки. Там же можно будет изменить его количество и просмотреть фотографию. <br>
    ![](/images/rmk/scheme/6252b70e49a8ff94cac2d9799cc4379f.png)

5. **Строки подвала** – позволяет задать номера строк подвала чека, которые будут видны в окне МРП2. Если поле оставлено пустым, то будут выводиться все строки, кроме пятой.

    > Для отображения пятой строки (список доп. свойств чека) необходимо принудительно её указать в настройках.
    {.is-info}

    ![](/images/rmk/scheme/494936f6d3ae53a3a6927e4e6ccc85cd.png)

6. **Всегда выводить отдельное окно оплаты**. Настройка указывает программе, что в момент оплаты чека необходимо отобразить «плавающее» окно для ввода оплаты.
7. **Не закрывать визуальный поиск**. Настройка указывает программе, что при подборе товара через визуальный поиск не нужно автоматически закрывать окно подбора при выборе товара.
8. **Отображать заголовок окна**. Установка признака позволит вывести у окна программы стандартный заголовок, позволяющий изменять размеры окна, сворачивать окно и получить доступ к настроенному меню программы.
9. **Всегда распределять суммы оплаты**. При установке параметра, в момент ввода суммы оплаты для какого-либо виды оплаты в случае, если зарегистрировано более одной платежной системы, то будет выведено окно для ручного распределения суммы между платежными системами. Например, если есть две наличные платежные системы – СБП и просто наличные, то при установленном признаке и вводе суммы в поле наличной оплаты будет выведено окно распределения суммы между СБП и наличными.
10. **Подтверждать выбор двойным щелчком**. При установке признака выбор из всех списков будет производится только по двойному щелчку мыши, а не по одиночному.
11. **Завершение сеанса**. Может быть введен интервал в секундах, по истечению которого, при отсутствии активности со стороны кассира, будет произведен выход из сессии кассира и выведено окно авторизации. При этом не завершенная работа над чеком будет сохранена.
12. **Интервал таймера**. Позволяет задать период в миллисекундах, с которым будет работать таймер и вызывать обработку **Проверка значений и прав доступа** с именем поля **timer**.
13. **Действие при отсутствии ответа от ГИС МТ**. Позволяет выбрать действие, которое необходимо выполнить, если **ГИС МТ** не ответила на запрос проверки КМ. Возможнные варианты действий:
    1. Разрешить продажу.
    2. Запретить продажу.
    3. Дать выбор кассиру.
14. **Инициализация Интерфейса.** Исполняемый скрипт, который вызывается два раза при запуске программы. Первый раз до создания всех органов управления. Второй раз после создания органов управления. Может содержать команду для установки цветов интерфейса. Отличить место вызова можно по значению переменной **МЕСТОВЫЗОВА**. При вызове до создания органов управления её значение будет равно "**beforeinit**", при вызове после создания органов управления "**afterinit**". Типовое использование скрипта – для задания настроек цветовой схемы и/или установки параметров командой **УСТАНОВИТЬПАРАМЕТРЫ**.

![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/89178a83ec11a7f1638533e23e770f6d.png)

```js
Сервис.РМККоманда( "УСТАНОВИТЬПАРАМЕТРЫ", 
"{""object_type"":""ware"", ""vs_treeview_scalefactor"":80, ""vs_listview_scalefactor"":80, ""vs_exclude_fields"":""remainder,article""}" );
```

Пример скрипта устанавливает следующие параметры окна визуального подбора товаров:

-   масштаб шрифта для дерева;
-   масштаб шрифта для списка;
-   убирает колонки с остатком и артикулом из списка.

```js
Параметры = ‘{ "object_type": "other", "rp_height": 775, "rp_width": 1000, "fp_height": 525, "rp_fontscale": 150, "sys_fontscale": 120 }’;

ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕВЫПОЛНИТЬКОМАНДУ, "УСТАНОВИТЬПАРАМЕТРЫ", Параметры );
```
Пример скрипта устанавливает параметры правой панели.

Доступны следующие тэги для настройки параметров.

| **Тэг**                 | **Описание**                                                                                                                                                                                                                                             |
|-------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| object_type             | Тип объекта, для которого передается описание. Возможные значения: **ware** – подбор товаров; **client** – подбор клиентов; **card** – подбор карт; **partner** – подбор контрагентов; **manager** – подбор сотрудника; **cheque** – выбор чека; **delay** – выбор отложенного чека; **footerlines** – настройка подвала окна. |
| vs_treeview_scalefactor | Масштаб шрифта в процентах, используемого в дереве окна визуального подбора. Допустимые значения от 30 до 300.                                                                                                                                           |
| vs_listview_scalefactor | Масштаб шрифта в процентах, используемого в списке окна визуального подбора. Допустимые значения от 30 до 300.                                                                                                                                           |
| vs_exclude_fields       | Строка, список полей через запятую без пробелов, которые необходимо убрать из списка визуального подбора.                                                                                                                                                |
| vs_treeview_partition   | Ширина дерева папок в процентах от ширины окна визуального подбора.                                                                                                                                                                                      |
| vs_columns_description  | Позволяет изменить формат вывода и содержимое данных в колонке списка. Значением тэга является массив объектов, задающих описание колонок списка визуального подбора.                                                                                    |
| vs_additional_fields    | Позволяет добавить собственные колонки в список. Значением тэга является массив объектов, задающих описание колонок списка визуального подбора.                                                                                                          |
| cs_exclude_fields       | Строка, список полей через запятую без пробелов, которые необходимо убрать из списка окна выбора чеков/отложенных чеков.                                                                                                                                 |
| cs_columns_description  | Позволяет изменить формат вывода и содержимое данных в колонке списка. Значением тэга является массив объектов, задающих описание колонок списка окна выбора чеков/отложенных чеков.                                                                     |
| cs_additional_fields    | Позволяет добавить собственные колонки в список. Значением тэга является массив объектов, задающих описание колонок списка окна выбора чеков/отложенных чеков.                                                                                           |
| cs_listview_order       | Позволяет указать колонку сортировки в списке подбора товаров.  Например, "cs_listview_order":"remainder DESC" (сортировать по наличию на складе в порядке убывания)                                                                                                                           |
| vs_listview_order       | Аналогично cs_listview_order. позволяет указать колонку сортировки в визуальном поиске товаров.  Например, "vs_listview_order":"remainder DESC" (сортировать по наличию на складе в порядке убывания)                                                                                          |
| rp_height               | Высота правой панели визуального поиска в точках.                                                                                                                                                                                                                                                                         |
| rp_width                | Ширина правой панели визуального поиска в точках.                                                                                                                                                                                                                                                                         |
| fp_height               | Высота панели функциональных кнопок (нижняя часть)                                                                                                                                                                                                                                                                        |
| rp_fontscale            | Дополнительный масштаб шрифта панели визуального поиска, например 120. Шрифт будет увеличен на 20%                                                                                                                                                                                                                        |
| sys_fontscale           | Программное дополнительное масштабирование системных шрифтов.                                                                                                                                                                                                                                                             |

Таблица с составом объекта описания колонки списка.

| **Тэг**    | **Описание**                                                                                                                                                                                                                                                                                                       |
|------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| label      | Текст заголовка колонки                                                                                                                                                                                                                                                                                            |
| fieldname  | Имя поля. По этому имени идентифицируется, какая колонка будет изменена. Предопределенные значения: maincode – код товара; article – артикул товара; name – наименование объекта (для всех справочников); price – цена товара; remainder – остаток товара; inn – ИНН контрагента; имена полей добавленных колонок. |
| expression | Часть запроса к базе, вычисляющая значение для колонки. Для обращения к полям справочника необходимо использовать префикс имен полей catalog. Например, dbo.fn_calcsklad( catalog.code, '', '001', '001', '')                                                                                                      |
| type       | Тип значения в колонке. Может быть одним из следующих: 1 – строка; 2 – число вещественное; 3 – число целое; 4 – дата; 5 – логическое.                                                                                                                                                                              |
| forecolor  | Код цвета текста в шестнадцатеричном виде с символом \# в начале. Например, \#A03030                                                                                                                                                                                                                               |
| backcolor  | Код цвета фона в шестнадцатеричном виде с символом \# в начале. Например, \#A03030                                                                                                                                                                                                                                 |
| width      | Ширина колонки в условных единица. Реальное значение ширины колонки будет зависеть от выбранного масштаба в параметрах системы и разрешения экрана. Например, стандартная колонка Цена в окне подбора товара имеет ширину 3900 единиц.                                                                             |
| alignment  | Выравнивание значения в колонке. Допустимые значения: 129 – по левому краю; 130 – по правому краю; 132 – по центру.                                                                                                                                                                                                |
| resizemode | Указывает системе, нужно ли автоматически расширять колонку при увеличении ширины окна или нет. Допустимые значения: 1 – нужно расширять; 2 – колонка фиксированной ширины.                                                                                                                                        |

Пример **JSON** описания.

```JSON
{
    "object_type": "ware",
    "vs_treeview_scalefactor": 110,
    "vs_listview_scalefactor": 110,
    "vs_treeview_partition": 15,
    "vs_exclude_fields": "article,barcodes",
    "vs_columns_description": [{
            "alignment": 130,
            "expression": "$$PRICE$$",
            "fieldname": "price",
            "forecolor": "#A03030",
            "label": "Цена",
            "resizemode": 2,
            "type": 2,
            "width": 1500
        }, {
            "alignment": 130,
            "expression": "$$REMAINDER$$",
            "fieldname": "remainder",
            "forecolor": "#E03030",
            "label": "Остаток",
            "resizemode": 2,
            "type": 2,
            "width": 1500
        }
    ]
}
```

Таблица с составом объекта настройки подвала окна.

| **Тэг**                          | **Описание** |
| --- | --- |
| lines                            | Массив со списком отображаемых строк.                                                                                                                                                                                                                                                                                                                                             |
| fields                           | Массив со списком отображаемых полей.                                                                                                                                                                                                                                                                                                                                             |
| Единичный объект массива lines:  |                                                                                                                                                                                                                                                                                                                                                                                   |
| number                           | Чисто целое от 1 до 5. Номер описываемой строки.                                                                                                                                                                                                                                                                                                                                  |
| height                           | Число целое. Высота строки в условных пикселях. Указанное значение будет умножено на масштаб отображения.                                                                                                                                                                                                                                                                         |
| fields                           | Строка, список имен полей через запятую, отображаемых в строке. Порядок полей важен. Поля будут отображаться в указанном порядке.                                                                                                                                                                                                                                                 |
| Единичный объект массива fields: |                                                                                                                                                                                                                                                                                                                                                                                   |
| name                             | Имя поля.  Допустимые имена полей: number – номер чека; count – остаток товара; total – итог по чеку; chequedsc – скидка на чек; cmname – название РМК; datetime – текущее время; cashier – имя кассира; client – владелец дисконтной карты; card – номер дисконтной карты; document – тип документа; manager – имя менеджера; partner – контрагент; pex – расширенные реквизиты. |
| label                            | Метка поля. Объект.                                                                                                                                                                                                                                                                                                                                                               |
| value                            | Выводимое значение. Объект.                                                                                                                                                                                                                                                                                                                                                       |
| Единичный объект label:          |                                                                                                                                                                                                                                                                                                                                                                                   |
| caption                          | Строка. Текст метки                                                                                                                                                                                                                                                                                                                                                               |
| swidth                           | Число целое. Ширина поля в пикселях. Если указана, то будет использоваться и умножаться на масштаб.                                                                                                                                                                                                                                                                               |
| width                            | Число целое. Относительная ширина в процентах от общей ширины. Используется, если не указана ширина в пикселях.                                                                                                                                                                                                                                                                   |
| forecolor                        | Строка. Шестнадцатеричное представление цвета текста. Например, "\#AAAAFF"                                                                                                                                                                                                                                                                                                        |
| backcolor                        | Строка. Шестнадцатеричное представление цвета фона. Например, "\#AAAAFF"                                                                                                                                                                                                                                                                                                          |
| font                             | Объект, описывающий шрифт метки.                                                                                                                                                                                                                                                                                                                                                  |
| alignment                        | Строка. Выравнивание по горизонтали. Допустимые значения: centr или center– по центру; right – справа; left – слева.                                                                                                                                                                                                                                                              |
| Единичный объект font:           |                                                                                                                                                                                                                                                                                                                                                                                   |
| name                             | Строка. Название шрифта.                                                                                                                                                                                                                                                                                                                                                          |
| size                             | Число целое. Размер шрифта.                                                                                                                                                                                                                                                                                                                                                       |
| bold                             | Логическое.                                                                                                                                                                                                                                                                                                                                                                       |
| italic                           | Логическое.                                                                                                                                                                                                                                                                                                                                                                       |
| underlined                       | Логическое.                                                                                                                                                                                                                                                                                                                                                                       |
| Единичный объект value:          |                                                                                                                                                                                                                                                                                                                                                                                   |
| swidth                           | Число целое. Ширина поля в пикселях. Если указана, то будет использоваться и умножаться на масштаб.                                                                                                                                                                                                                                                                               |
| width                            | Число целое. Относительная ширина в процентах от общей ширины. Используется, если не указана ширина в пикселях.                                                                                                                                                                                                                                                                   |
| forecolor                        | Строка. Шестнадцатеричное представление цвета текста. Например, "\#AAAAFF"                                                                                                                                                                                                                                                                                                        |
| backcolor                        | Строка. Шестнадцатеричное представление цвета фона. Например, "\#AAAAFF"                                                                                                                                                                                                                                                                                                          |
| font                             | Объект, описывающий шрифт поля.                                                                                                                                                                                                                                                                                                                                                   |
| alignment                        | Строка. Выравнивание по горизонтали. Допустимые значения: centr или center– по центру; right – справа; left – слева.                                                                                                                                                                                                                                                              |

Пример JSON описания строк подвала.

```js
JSON_FOOT = "{ ""object_type"": ""footerlines"", ""lines"": [{""number"" : 1, ""height"" : 50,""fields"" : ""total""}, {""number"" : 6,""height"" : 32,""fields"" : ""number,count"" } ], ""fields"" : [{ ""name"": ""total"",""label"": { ""caption"": ""Набрали на"", ""swidth"": 30, ""width"": 30, ""forecolor"": ""\#000000"", ""backcolor"":  \#AAAAFF"", ""font"": { ""name"":""Arial"", ""size"" : 30, ""bold"" : true }, ""alignment"": ""centr"" }, ""value"": {""width"": 70, ""swidth"": 70, ""forecolor"": ""\#FF0000"", ""backcolor"": ""\#AABBFF"",""font"": { ""name"":""Arial"", ""size"" : 30, ""bold"" : true, ""italic"" : false, ""underlined"" : false },""alignment"": ""centr"" } } ] }";

ОТПРАВИТЬСООБЩЕНИЕ( _ДЕСКРИПТОРОКНА, _СООБЩЕНИЕВЫПОЛНИТЬКОМАНДУ, "УСТАНОВИТЬПАРАМЕТРЫ", JSON_FOOT );
```

Скрипт **Дополнительные реквизиты строки** позволяет добавить и изменить состав информации, выводимой в строке регистрации. Скрипт выполняется для каждой строки регистрации и позволяет оформить вывод данных на основе всех полей отображаемой строки.

![](media/6545ebe8aaabab782d6d55133bbecba8.png)

Доступны следующие тэги для настройки параметров.

| **Тэг**                   | **Описание**                                                                                                                                                                                                                                |
|---------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **id**                    | Уникальный идентификатор элемента. Используется для идентификации элемента при необходимости его удалить (команда УДАЛИТЬДОПСВОЙСТВО)                                                                                                       |
| **layout**                | Составной тэг, описывающий расположение элемента в строке.                                                                                                                                                                                  |
| **layout.newline**        | Значение 1 указывает, что с этого элемента нужно начать новую строку, значение 0 – выводить в текущей строке. По умолчанию для первого элемента равно 1, для остальных 0.                                                                   |
| **layout.anchor**         | Привязка к правому или левому краю строки. Значение **right** означает, что нужно выводить правее, **left** – левее. По умолчанию используется **left**.                                                                                    |
| **layout.width**          | Число целое – ширина элемента в условных точках. Реальная ширина будет получена умножением на текущий коэффициент масштабирования.                                                                                                          |
| **layout.height**         | Число целое – ширина элемента в условных точках. Реальная высота будет получена умножением на текущий коэффициент масштабирования. Общая высота строки вычисляется как максимальное значение из высот всех дополнительных элементов строки. |
| **layout.alignment**      | Выравнивание значения внутри прямоугольника элемента. Допустимые значения **left** (по умолчанию), **right**, **center**                                                                                                                    |
| **text**                  | Выводимый текст.                                                                                                                                                                                                                            |
| **image**                 | Изображение, выводимое вместо или вместе с текстом.                                                                                                                                                                                         |
| **Image.src**             | Пусть к изображению на носителе.                                                                                                                                                                                                            |
| **Image.mark**            | Если указан тэг **mark** со значением 1, то вместо изображения из тэга **src** будет выведен прямоугольный маркер указанного цвета.                                                                                                         |
| **Image.color**           | Цвет маркера. Может быть название либо шестнадцатеричное представление цвета, Например, \#AABBCC                                                                                                                                            |
| **style**                 | Дополнительная стилизация внешнего вида элемента.                                                                                                                                                                                           |
| **style.font**            | Шрифт, которым необходимо вывести текстовое значение. По молчанию, используется шрифт дополнительных строк в строке списка регистрации.                                                                                                     |
| **style.font.name**       | Название шрифта.                                                                                                                                                                                                                            |
| **style.font.bold**       | Значение 1 для использования жирного варианта шрифта.                                                                                                                                                                                       |
| **style.font.italic**     | Значение 1 для использования наклонного варианта шрифта                                                                                                                                                                                     |
| **style.font.underlined** | Значение 1 для использования подчеркнутый варианта шрифта                                                                                                                                                                                   |
| **style.font.size**       | Размер шрифта в точках (points). Указанный размер будет умножен на коэффициент масштабирования шрифта списка регистрации.                                                                                                                   |
| **style.color**           | Цвет шрифта.                                                                                                                                                                                                                                |
| **style.backcolor**       | Цвет фона элемента                                                                                                                                                                                                                          |


Раздел **Настройки панели товаров** позволяет определить, сколько кнопок товаров будет отображаться на одной странице товарной матрицы. Максимальное количество 30 кнопок, т. е. пять колонок по шесть строк. Минимальное количество – одна кнопка, т. е. одна колонка и одна строка.

1. **Выводить для товара** – позволяет выводить или прятать отдельные параметры товара в ячейке.
2.  **Не показывать товары без цены** – параметр укажет системе, что при формировании списка товаров, товары без учетной цены не будут в него попадать. Параметр относится и к панели товаров, и к визуальному поиску товаров.
3.  **Не показывать товары без остатка** – параметр укажет системе, что при формировании списка товаров, товары без остатка не будут в него попадать. Параметр относится только к панели товаров.
4.  **Кэшировать содержимое папок**. Если признак установлен, то содержимое папки будет прочитано только один раз при первом входе в папку с товарами. В противном случае, содержимое папки будет читаться из базы каждый раз при входе в папку. Установка признака позволит ускорить работу программы. Снятие признака позволит оперативно реагировать на изменения состава товаров, отображаемых в папках.

## Прочие настройки

![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/8a24c9adf4aba886e3f96560af554afc.png)

В поле **Округлять сумму чека** можно выбрать алгоритм округления, согласно которому будет округляться сумма чека. Полученная разница будет отнесена на скидку, если сумма чека станет меньше, либо в наценку, в обратном случае.

Установка параметра **Использовать цену из марки** укажет системе, что при чтении марки маркированного товара цену продажи нужно взять из марки.

Параметр **Разрешить несколько карт в чеке** позволит кассиру ввести несколько карт клиентов. Это может пригодиться, например, при оплате бонусными баллами. Накопленными на нескольких картах, либо, для применения нескольких скидок.

При установленном параметре **Выводить информацию при вводе карты** система, при вводе кассиром карты клиента выведет окно, с информацией об обороте карты и накопленных бонусных баллах.

![Изображение выглядит как текст Автоматически созданное описание](/images/rmk/scheme/a62e2d6a910aa316c890f3d93d012d0f.png)

Параметр **Выключать компьютер** при **завершении работы** укажет программе, что необходимо выключить компьютер в момент завершения работы с РМК. Пользователь Windows должен иметь права на программное выключение компьютера.

Параметр **Выводить поверх всех окон** укажет программе, что окно программы должно быть поверх всех окон на экране. Это ограничит возможность запуска других программ на компьютере кассира. Совместно с признаком выключения компьютера при завершении программы не позволит выходить кассиру в ОС.

Параметр **Запрашивать комментарий для отложенных чеков** укажет системе на необходимость запросить комментарий к чеку, при его откладывании. Это упростит работу официантов с пречеками клиентов.

При установленном параметре **Не выводить контекстное меню,** МРП 2 не будет выводить меню, при щелчке мыши на строке чека.

Параметр **Показывать архивные карточки** позволяет управлять отображением в списках выбора карточек, перенесённых в архив.

Параметр **Фильтр на свободное количество** управляет отображением товаров без положительного остатка в визуальном поиске товаров.

Параметр **Выбирать ФР для печати чека** позволит кассиру выбрать ФР, на котором необходимо напечатать чек из списка доступных устройств. Выбор будет предоставлен непосредственно перед печатью чека.

При установке параметра **Запретить превышение возвратов**, программа будет проверять соответствие суммы чека возврата товара сумме чека продажи, на основании которого выписывается возврат. Если по одной продаже было выполнено несколько возвратов, то будет проверяться общая сумма всех возвратов, связанных с одной продажей.

Параметр **Сигнал, если товар не найден по ШК**, укажет программе, что если при чтении ШК сканером ШК не был распознан и товар, соответствующий ШК не был найден в справочнике товаров, то вместо вывода сообщения о том, что товар не найден будет воспроизведен звуковой сигнал. Сигнал будет воспроизведен из файла **nfsound.wav,** rкоторый должен находиться в рабочем каталоге программы **irmk.exe**.

Параметр **Оплачивать чек после печати**, укажет программе, что чеки продажи сначала необходимо распечатать и отправить в ОФД, а после этого предложить оплатить их. При этом, чек на продажу будет оформлен с видом оплаты в кредит. Чек на оплату будет оформлен как оплата соответствующего кредита. Методика работы с пост оплатой чека описана в разделе [Постоплата чеков](/rmk/working#постоплата-чеков).

Параметр **Текст чека оплаты кредита** позволяет указать, какая строка будет добавлена в чек, при оплате товаров, ранее отданных в кредит. Если указан текст, то при формировании чека на основании чека с кредитом, будет предложено ввести сумму оплаты кредита и в чеке будет «свободная продажа» с введенной суммой и текстом из этого поля.

Параметр **Текст для чека аванса** позволяет указать, какая строка будет добавлена при выборе операции для чека Аванс. Если указан текст, то в момент выбора операции Аванс (из списка), будет предложено ввести сумму аванса и в чеке будет «свободная продажа» с введенной суммой и текстом из этого поля.
