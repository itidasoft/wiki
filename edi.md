---
title: Модуль Айтида: ЭДО
description: 
published: true
date: 2022-07-29T23:11:24.258Z
tags: эдо, электронный документооборот
editor: markdown
dateCreated: 2022-04-03T12:41:29.605Z
---

# Назначение.

Модуль обмена сообщениями с операторами ЭДО (модуль ЭДО) предназначен для автоматизации процессов создания учетных документов в системе Айтида на основании входящих электронных документов, получаемых от оператора ЭДО. И отправки созданных в системе Айтида учетных документов, контрагентам в электронном виде через оператора ЭДО. Для входящих документов модуль ЭДО поддерживает получение, утверждение или отказ от приема. Учетные документы могут быть созданы из следующих файлов обмена:

1.  Универсальный передаточный документ (файл в формате ON_NSCHFDOPPR\*.xml );
2.  Торг-12 (файл в формате DP_TOVTORGPR\*.xml);
3.  Акт приемки выполненных работ (файл в формате DP_REZRUISP\*.xml);
4.  Счет (файл в формате ON_SCHET \*.xml);
5.  Заказ (файл в формате ON_ORDER \*.xml).

Из входящих сообщений могут быть созданы следующие типы учетных документов:

1.  Приходная накладная;
2.  Акт услуг входящий;
3.  Счет входящий;
4.  Заказ от покупателя.

Ко входящим сообщениям могут быть приложены дополнительные произвольные вложения, которые будут сохранены в базе данных и к ним будет возможен доступ.

Для исходящих документов поддерживается отправка четырёх видов стандартных документов:

1.  Универсальный передаточный документ (файл в формате ON_NSCHFDOPPR\*.xml ). Документ создается из расходной накладной.
2.  Акт приемки выполненных работ (файл в формате DP_REZRUISP\*.xml). Документ создается из акта услуг исходящего.
3.  Счет (файл в формате ON_SCHET \*.xml). Документ создается из счета исходящего.
4.  Заказ (файл в формате ON_ORDER \*.xml). Документ создается из заказа поставщику.

К исходящим сообщениям могут быть приложены дополнительные вложения, которые будут отправлены вместе с основным документом.

# Подключение и настройка модуля ЭДО

Для подключения модуля ЭДО необходимо добавить в систему меню программы пункт *Модуль ЭДО* (название пункта может быть изменено партнёром по его усмотрению). В дистрибутивной базе данный пункт расположен в меню Сервис. Для самостоятельного подключения этого пункта необходимо использовать команду `DO FORM ediform`.

![](/images/edi/5ab672ea9e41700e33ccc417480d86f8.png)

Для отображения добавленного пункта в меню необходимо перезапустить систему Айтида.

>   Внимание! Модуль ЭДО не доступен в следующих конфигурациях:
> *Айтида EasyBox*;
> *Айтида EasyBox-кафе*;
> *Айтида Малый бизнес*;
> *Айтида Плюс*;
> *Айтида Кафе*;
{.is-info}



Первый запуск модуля необходимо произвести от имени пользователя с правами администратора. В этом случае будет доступен функционал по настройке модуля:

![](/images/edi/17fcf9f937025be91ec095b8cdef8c7a.png)

Настройка модуля производится для каждой организации и оператора ЭДО, с которыми предполагается обмен сообщениями. В окне настройки необходимо задать следующие параметры:

![](/images/edi/3eb8f0463c500fc6bd4a1120351d127f.png)

1.  Раздел **Параметры доступа к системе ЭДО**.
    -   **Сертификат** – необходимо выбрать сертификат для электронной подписи документов, отправляемых в систему ЭДО. Это должен быть тот же сертификат. С которым производилась регистрация в системе ЭДО. Сертификат должен располагаться в хранилище Личных сертификатов компьютера.
    -   В поле **Оператор ЭДО** необходимо выбрать оператора ЭДО, к которому подключен клиент.
    -   В полях **Пользователь** и **Пароль** указываются учетные данные для входа в систему ЭДО, выбранного оператора.
    -   Если оператор ЭДО позволяет с одними учетными данными регистрировать несколько аккаунтов, то необходимый аккаунт нужно указать в поле **Аккаунт**.
    -   В поле ЭДО ИД необходимо указать идентификатор пользователя, присвоенный оператором ЭДО организации.
    -   В поле **Дата загрузки** записывается дата последнего загруженного документа. Поле доступно для корректировки и позволяет, при необходимости, загрузить документы с более ранней даты, отстоящей от текущей не более чем на 30 дней.
    -   Признак **Тестовый контур** действует только в отношении оператора ЭДО Такском. В этом случае, обмен сообщениями будет производиться через тестовый сайт оператора.

Обязательно нужно выбрать фирму и склад. С этими параметрами будут формировать входящие учетные документы на основании полученных сообщений. Если выбрать папки для новых товаров и контрагентов, то создаваемые карточки будут сразу помещаться в эти папки.

>   Для товаров в выбранной папке может быть указана группа ресурсов. В таком случае, при создании новых товаров будут автоматически заполнены поля новых карточек такие как:
> *Группу товара*;
> *Код налога*;
> *Единица измерения и т.п.*.
{.is-info}


> При загрузке из ЭДО в Айтиду будут добавляться только те документы. У которых статус в системе ЭДО не подтвержден и не отказан. Подтвержденные и отказанные УПД загружаться не будут.
{.is-info}


![](/images/edi/d8399c15a1311fbd4d7b0a2ebcde64ee.png)

В разделе **Подписант документов** необходимо указать ФИО и должность лица, уполномоченного подписывать документы.

Кнопка **Проверка входящих** позволяет ввести скрипт проверки каждого загружаемого документа. Если будет задан такой скрипт, то он будет вычисляться для каждого полученного из системы ЭДО документа. Если вычисление вернет значение Истина, то документ будет загружен. Иначе, будет пропущен и пользователю будет сообщено, что часть документов была пропущена, т.к. не прошла по фильтру. Задание такой проверки необходимо, например, если есть несколько торговых точек и в каждой необходимо принимать только необходимые в этой точке документы.

Для анализа загружаемого документа скрипт может использовать переменные, имена которых составлены из названий тэгов принимаемого XML файла.

Например, для доступа к улице из адреса грузополучателя можно использовать переменную *Файл_Документ_СвСчФакт_ГрузПолуч_Адрес_АдрРФ_Улица.*
![](/images/edi/bef02a9e9c9053b38fdafba1a977d5cc.png)

Проанализировать её значение, например, на вхождение в название улицы в адресе грузополучателя слова «Красная», и если такое вхождение есть, то загрузить документ.

```js
RETURN “красная”$LOWER(Файл_Документ_СвСчФакт_ГрузПолуч_Адрес_АдрРФ_Улица );
```

>   Для упрощения доступа к наиболее часто используемым переменным в систему добавлены специальные понятия:
{.is-info}


![](/images/edi/d0e98ad51bc2a947b719d70132030048.png)

>   Часть тэгов в файлах является не обязательной для указания. В случае, если тэга нет в принимаемом файле, соответствующая переменная не будет определена. Анализ значения такой переменной приведет к ошибке вычисления и документ будет пропущен. Для предотвращения таких ситуаций рекомендуется использовать функцию **ПЕРЕМЕННАЯ( ИмяПеременной[,ЗначениеПоУмолчанию])** для безошибочного вычисления значения переменной.
{.is-info}


![](/images/edi/0fe5b4723b5b6cb528ad774c9311669e.png)

Закладка Скрипты доступна в режиме настройки. На ней можно проверить наличие стандартного скрипта обмена с системой ЭДО, а так же задать С**крипт проверки и расчетов**.

Скрипт проверки и расчетов вызывается в момент передачи учетного документа в модуль ЭДО. Скрипт может задать параметры документа в ЭДО. Например, определить ЭДО ИД контрагента, которому отправляется сообщение. Автоматически прикрепить вложения к сообщению и т.п. На вход скрипту передается ИД создаваемого исходящего сообщения (значение поля identity_column таблицы edioutcome). Скрипт может заполнить любые поля и связанные таблицы необходимыми данными. Например, на основании фирмы отправителя сможет подобрать ЭДО ИД контрагента получателя, таким образом, чтобы обмен сообщениями происходил без роуминга.

![](/images/edi/6da788dc91e17557bd801f56329158d8.png)

```js
ЭДОИД	= ЛЕВСИМВ( ЗАПРОС( "SELECT value FROM param_ex WHERE param= 'EDI_EDIID" + ПРЕДПРИЯТИЕ + "'" ), 3 );
КлиенЭДОИД= ЗАПРОС( "SELECT CASE WHEN LEFT( ediid, 3 ) = '" + ЭДОИД + "' OR LEFT( ediid2, 3 ) <> '" + ЭДОИД + "' THEN ediid ELSE ediid2 END  FROM sprclient  WHERE code = (SELECT client FROM edioutcome WHERE identity_column = " + ИДДокумента + ")" );
IF !EMPTY( КлиенЭДОИД ) 
	ЗАПРОС( "UPDATE edioutcome SET cediid= '" + КлиенЭДОИД + "' WHERE identity_column = " + ИДДокумента );
	
RETURN true;	
```

# Получение входящих сообщений.

Для загрузки входящих УПД в модуле ЭДО необходимо перейти на закладку **Входящие**.

![](/images/edi/cfc41d50994c3fdbf0b405b8c600bcbf.png)

Список содержит следующие колонки:

| | |
| --- | --- |
| **М**                 | Колонка предназначена для отметки сертификата в списке. Отметка нескольких документов может использоваться для групповых операций.                                                                                                                                                                                                                                                     |
| **А**                 | Содержит признак того, был ли погашен сертификат: – желтый – был отправлен ответ на документ; – зеленый – документооборот завершен успешно; – лиловый – был получен отказ; – оранжевый – было получено предложение об аннулировании; – серый – документ аннулирован; – красный – продукция по сертификату была полностью возвращена.  
| | ![](/images/edi/48ba3f2af33c7d24f8c65abe030200b4.png)  |
| **Д**                 | Содержит признак того, что на основании сертификата была создана приходная накладная. ![](/images/edi/ce445978a150f6f52a67c895d23252c4.png) – документ был подтвержден; - документ был отказан ![](/images/edi/d2b5b4e7ca935ac80771e6906c89b12b.png)                                                                                                                                               |
| **Номер сертификата** | Номер входящего документа                                                                                                                                                                                                                                                                                                                                                              |
| **Дата**              | Дата входящего документа                                                                                                                                                                                                                                                                                                                                                               |
| **Сумма**             | Если есть, то сумма входящего документа                                                                                                                                                                                                                                                                                                                                                |
| **Контрагент**        | Наименование контрагента. От которого поступил документ.                                                                                                                                                                                                                                                                                                                               |
| **ИНН/КПП**           | ИНН и КПП контрагента                                                                                                                                                                                                                                                                                                                                                                  |
| **Описание**          | Дополнительное описание документа, которое мог указать отправитель                                                                                                                                                                                                                                                                                                                     |
| **ЭДОИД контрагента** | Идентификатор отправителя в системе ЭДО                                                                                                                                                                                                                                                                                                                                                |
| **Ответ системы**     | В случае ошибок, сообщение об ошибке.                                                                                                                                                                                                                                                                                                                                                  |

Нажатие кнопки **Загрузить входящие документы из системы ЭДО** вызовет процедуру загрузки входящих сообщений из системы ЭДО. Айтида отправляет запрос в систему ЭДО на поиск изменений документов начиная (включительно) с даты, указанной в параметрах модуля, по текущий момент. Если указанная в параметрах дата отстоит от текущей более чем на 30 дней, то запрос ограничивается последними тридцатью днями.

Если во входящих документах есть еще не обработанные сообщения, то они будут загружены в Айтиду. Во время загрузки система сопоставляет загружаемые документы с имеющимися в базе данных, ранее загруженными документами. Сопоставление производится по идентификаторам, которые предоставляет система ЭДО. Документы из системы ЭДО, для которых было найдено сопоставление в базе данных Айтиды, пропускаются. Если система ЭДО поддерживает версионность документов, т.н. редакции, например СБИС, то разные редакции рассматриваются Айтидой как разные документы и по отдельности загружаются в систему. При этом, номер начальной редакции соответствует номеру документа, который присвоил поставщик. К последующим редакциям добавляется суффикс /РЕДN – где N номер редакции.

Если возникла необходимость в повторной загрузке документа, то предварительно нужно удалить ранее загруженный вариант документа.

>   Входящее сообщение (документ) в системе ЭДО может содержать несколько вложений (файлов). Если система ЭДО сама не ранжирует такие вложения, определяя, какое и вложений является главным, то Айтида делает это самостоятельно. Самый высокий приоритет отдается УПД и счетам фактурам. Затем актам выполненных работ, накладным, счетам и заказам. Это означает, что если во входящем сообщении есть УПД и счет, то Айтида будет рассматривать такое сообщение как поставка и сформирует приходную накладную, на основании XML файла УПД. Если во входящем документе не будет УПД, а будет только счет, то будет сформирован счет входящий.
{.is-info}


В случае успешного обмена данными с системой ЭДО будет выведено сообщение об успешной загрузке некоторого количества документов, либо сообщение о том, что новые документы не найдены.

![](/images/edi/b04455cc8f8c20bfa37825565625aa7b.png)

Если во время обмена данными произошли ошибки, то будет выведено соответствующее сообщение. Подробный отчет об обмене данными с системой ЭДО можно посмотреть в журнале обмена.

>   Журнал обмена с системой ЭДО записывается в файл, имя которого указано в константе **\_ЭДОИМЯФАЙЛАЖУРНАЛА**. Если такой константы нет в системе, то по умолчанию используется имя файла **d:\\ edi_http.log**
{.is-info}


## Загрузка файлов в формате ФНС XML.

В случае, если на момент использования ПО Айтида ещё нет профиля для обмена с нужной системой ЭДО, то можно поступить следующим образом.

В системе ЭДО сохранить входящие УПД в файлах XML. Файлы будут в формате, регламентируемом ФНС для обмена УПД в электронном виде.

Затем, в модуле ЭДО необходимо перейти на закладку **Входящие**.

![](/images/edi/71357b003231811d64ff05a1df71f1cd.png)

Нажать кнопку **Загрузить документ из файла XML**. Будет предложено выбрать файл для загрузки.

![](/images/edi/2b5316b3e3bc8337e2a2fd926a1e6195.png)

Загруженный из файла документ становится равноправным документом, для которого доступны функции проверки и создания учетных документов.

Вне зависимости от того, как был загружен документ в Айтиду, для него производятся следующие сопоставления.

1.  Ищется поставщик в справочнике контрагентов. Поиск осуществляется по в следующем порядке:
    -   по идентификатору контрагента в системе ЭДО (поля **ЭДО ИД / ЭДО ИД 2** в карточке контрагента);
    -   по ИНН и КПП;
    -   по ИНН среди контрагентов без указанного КПП.
2.  Для каждой строки документа ищется товар в справочнике ТМЦ. Поиск осуществляется в следующем порядке:
    -   если был передан ШК товара, то ищется по нему;
    -   иначе, ищется по названию товара в справочнике.

## Проверка принятых документов.

Загруженные из системы ЭДО документы можно проверить на правильность. Для этого, необходимо дважды щелкнуть на нужном документе, или в контекстном меню выбрать пункт **Просмотр/корректировка документа**.

![](/images/edi/16991d1e4b239934c1e953c6e51538f9.png)

В открывшемся окне будет выведена информация из основного документа, полученного сообщения.

![](/images/edi/f0e9c6368495a9678d729d3a20df619a.png)

В шапке документа можно проверить реквизиты контрагента, от которого получен документ. В многострочной части документа отображается список товаров и услуг.

В поле **Тип документа в Айтиде** необходимо выбрать тип документа, который будет создан на основании входящего сообщения.

В колонках **Наименование из ЭДО**, **Количество, Цена, Сумма и** **Единица** будут выведены реквизиты принимаемого товара/услуги из ЭДО. В колонке **Фактическое количество** необходимо указать реально поступившее количество товара/принимаемых услуг.

В форме Проверка документа доступно сопоставление загруженных из **ЭДО** товаров и услуг с товарами и услугами из справочников Айтиды. Если в колонках **Код** и **Наименование в Айтиде** значение не указано, то это значит, что сопоставление еще не было выполнено, и его необходимо выполнить в этой форме, до создания учетного документ. В колонках **Наименование из ЭДО** и **Наименование в Айтиде** отображаются наименования, соответственно, загруженные из **ЭДО** и из карточки сопоставленного товара/услуги в Айтиде. Наличие двух наименований облегчает поиск ошибок при сопоставлении товаров. При обнаружении ошибок в сопоставлении, можно нажать на кнопку ![](/images/edi/cf533c5ca5943751da728f747652392c.png) в колонке **У**, что позволит разорвать ранее установленную связь и выполнить сопоставление заново.

В списке доступны сортировка и фильтрация данных, аналогично другим формам системы Айтиды.

Фактическое количество может быть указано одним из следующих способов:

-   введено в соответствующую ячейку списка;
-   последовательным чтением ШК всех принятых товаров (при чтении сканером ШК количество в соответствующей строке будет увеличиваться на 1);
-   загрузкой ШК из ТСД (кнопка **Загрузка данных из ТСД** ![](/images/edi/fadc575a92ba4da538d19c3a41656ce2.png) ).

В списке товаров применяется цветовая индикация:

-   зелёный – строки, в которых количество по накладной совпадает с фактическим количеством;
-   голубой – строки, в которых количество по накладной больше фактического количества;
-   розовый – строки, в которых количество по накладной меньше фактического количества.

В поле **Утвердить/Отклонить** необходимо выбрать вариант ответа контрагенту. Возможно только полное подтверждение или полный отказ от документа. В случае отказа от документа, необходимо указать причину отказа, заполнив поле **Комментарий**.

Нажатие на кнопку **Записать** приведёт к записи изменений. Если в списке остались не сопоставленные записи и установлен признак **Создавать карточки для новой продукции**, то в момент сохранения будут созданы и автоматически сопоставлены недостающие товары. Нажатие на кнопку **Отмена** приведёт к отмене изменений.

## Дополнительные вложения к сообщениям из системы ЭДО.

Сообщения, поступающие из системы ЭДО, помимо самих документов могут содержать дополнительные вложения, такие как:

-   Печатные формы в формате PDF;
-   Таблицы в формате MS Excel;
-   Тексты документов в форматах различных редакторов;
-   Картинки и многое другое.

Все дополнительные вложения, получаемые с входящими сообщениями сохраняются в базе данных Айтиды и привязываются к входящему документу. Для доступа к таким файлам необходимо в списке документов установить курсор на нужный документ и нажать кнопку **Приложения к документу**.

![](/images/edi/f5ce9ea95d38033558839c64c6c8176f.png)

В открывшемся списке можно просмотреть или сохранить нужный документ.

![](/images/edi/e81da7a428487811d15267b096bf5118.png)

Если какие-то файлы не нужны, то их можно удалить из базы данных, нажав на кнопку **Удалить.**

## Подтверждение сообщений в системе ЭДО.

После проверки документа и выбора варианта ответа – подтверждение или отказ – необходимо отправить эту информацию в систему ЭДО. Для этого необходимо отметить документ в списке и нажать кнопку отправки в ЭДО:

![](/images/edi/e6f6bad1b0603d64812f87c35c85f5b2.png)

При успешной отправке маркер в колонке С будет зеленым. Одновременно с отправкой ответа, в систему ЭДО отправляются и подписываются все служебные уведомления, которые предусмотрены регламентом ЭДО. Подпись документов осуществляется выбранным в параметрах модуля ЭДО сертификатом. Отправка ответов возможна только для документов, загруженных из системы ЭДО. Если документ был загружен их файла, то отправить акт необходимо из интерфейса самой системы ЭДО.

## Создание учетных документов из входящих сообщений.

После завершения всех процедур по подтверждению документа необходимо создать учетный документ. Для этого необходимо отметить документ в списке и выбрать пункт контекстного меню **Создать [тип создаваемого документа]**.

![](/images/edi/417daf992f2ab78a911748ac601ac007.png)

# Отправка документов в систему ЭДО.

Следующие типы документов могут быть отправлены в систему ЭДО из интерфейса Айтиды:

1.  Расходные накладные.
2.  Акты услуг исходящие.
3.  Счета исходящие.
4.  Заказы поставщикам.

Перед отправкой необходимо подготовить и провести учетный документ. Сформировать все необходимые дополнительные вложения.

После успешной записи и проведения документа необходимо выбрать пункт **Выгрузка в систему ЭДО** кнопки **Работа с оборудованием**. ![](/images/edi/1745d9d08ad0258d9f59e4168eacfc47.png).

>   Важно. Перед отправкой документа в систему ЭДО следует обратить особое внимание на полноту заполнения полей справочников. Для различных ЭД важны такие реквизиты как:
> *Код ОКЕИ у единиц измерения;*
> *ЭДО ИД, ИНН, КПП, правильное наименование, адрес, включая регион расположения для контрагентов;*
> *Правильное полное наименование, код налога для отгружаемого товара.*
{.is-warning}


По фирме отправителю Айтида определит подходящую систему ЭДО в модуле ЭДО и для неё будет создан документ на закладке **Отгрузка**. В момент формирования будет выполнен **Скрипт проверки и расчета** из параметров модуля. Скрипт может изменить настройки, определенные Айтидой на собственные. Скрипт должен вернуть Истину, если необходимо добавить документ на отправку в ЭДО, либо Ложь, если необходимо отменить отправку.

Отправку документов можно выполнять по одному документу либо сразу несколько, отметив их в журнале документов и выбрав указанный выше пункт меню кнопки **Работа с оборудованием**.

![](/images/edi/e2b7ff9d68814a935725b68ed9a8ffc7.png)

## Дополнительные вложения к исходящим сообщениям.

Сообщения, которые планируется отправить контрагенту, помимо основного документа, такого как УПД, Акт выполненных работ, Счет, Заказ, могут содержать дополнительные вложения, такие как:

-   Печатные формы в формате PDF;
-   Таблицы в формате MS Excel;
-   Тексты документов в форматах различных редакторов;
-   Картинки и многое другое.

Все дополнительные вложения, необходимые к отправке получателю, должны быть добавлены к исходящим сообщениям до их отправки. Для этого необходимо в списке документов установить курсор на нужный документ и нажать кнопку **Приложения к документу**.

![](/images/edi/fe79b053b29eea162d853967fd059f39.png)

В открывшемся списке можно просмотреть / удалить ранее добавленные файлы, или добавить новые.

![](/images/edi/801073c6bec5ce04f90317ef93e2b8c8.png)

## Отправка документов в систему ЭДО.

Для отправки документа в систему ЭДО необходимо его отметить и нажать **Отправить отмеченные документы в систему ЭДО.**

![](/images/edi/0bbfd127e35afec72b998363b0c792f6.png)

При успешной отправке будет выведено сообщение об успешной отправке документов:

![](/images/edi/a8a0b7b612575c3b00746d02b26c8802.png)

Через некоторое время после успешной отправки необходимо нажать кнопку проверки статусов отправки:

![](/images/edi/0a0dbfc2c51438172e3a125b1c6ec576.png)

Сначала статус должен стать желтым, т. е. система ЭДО приняла документ:

После подтверждения или отказа от документа получателем статус изменится на зеленый или серый:

![](/images/edi/181ac30e318062741a989746dd2f7f23.png)

В случае, если учетный документ проведен в Айтиде и получатель подтвердил документ, то запись убирается из списка. Для отображения всех документом можно установить признак **Выводить документы со всеми статусами**.

В случае возникновения ошибок на каком-либо этапе статус документа будет красный, а в графе **Описание** будет указана причина ошибки. Просмотреть обмен служебными сообщениями можно выбрав пункт Документооборот контекстного меню списка.

![](/images/edi/4a666ac20944e8643c5f1386e620d891.png)

![](/images/edi/b5e5c5e4fa7c370a8769f52648017ce1.png)
