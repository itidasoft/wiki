---
title: API для работы с файлами обновлений
description: Автообновление РМК
published: true
date: 2025-03-24T13:55:17.197Z
tags: 
editor: markdown
dateCreated: 2025-03-24T08:20:42.981Z
---

# Адрес сервера
URL для всех запросов - https://api.itida.ru


# Авторизация пользователя
## POST /auth/login

В теле запроса передается объект с полями:
- **username** - имя пользователя
- **password** - пароль пользователя

Пример:

```json
{
    "username": "user@mail.ru",
    "password": "123456"
}
```

## Ответ
```json
{
    "accessToken": "eyJhbGciOiJIUz...",
    "refreshToken": "eyJhbGciOiJIUzI....",
    "user": {
        "username": "user@mail.ru",
        "fullName": "User Name",
        "id": 1,
        "isActivated": true,
        "roles": "ADMIN"
    }
}
```
- **accessToken** - токен авторизации, который требуется использовать в запросах, требующих авторизацию
- **refreshToken** - токен для обновления авторизационного токена без использования логина и пароля
- **user. username** - логин авторизованного пользователя
- **user. fullName** - Имя авторизованного пользователя
- **user. id** - ИД авторизованного пользователя
- **user. isActivated** - признак активации пользователя (true - пользователь активирован, false - не активирован)
- **user. roles** - роль пользователя

Используется вариант авторизации "Bearer Token".
Из полученного ответа требуется взять значение accessToken и во всех запросах, требующих авторизации,  установить это значение в заголовок авторизации
```json 
Authorization: Bearer ТокенАвторизации
````
где ТокенАвторизации - это полученное значение токена авторизации в ответе на запрос авторизации пользователя.

# Запрос добавления файла на сервер
## POST /files/updatefile

> Требуется авторизация
{.is-info}

**Параметры запроса**: отсутствуют

**Тело запроса**: Содержимое в теле запроса должно быть в формате **"form-data"**
Обязательны для передачи следующие ключи:
- **date** - дата обновления в формате YYYY-MM-DD
- **version** - версия файла обновления
- **file** - сам файл обновления

![updatefile.png](/images/api/updates/updatefile.png){.align-center}

## Ответ

### Tabs {.tabset}

#### 200
```json 
{
    "status": true,
    "message": "Файл обновления загружен",
    "data": {
        "name": "update_DB_469-EXEDLL_469.cab",
        "mimetype": "application/vnd.ms-cab-compressed",
        "size": 25561368
    }
}
```
- **status** - признак успешного (true) или неуспешного (false) результата загрузки файла на сервер
- **message** - сообщение о результате загрузки файла
- **data. name** - имя загруженного файла
- **data. mimetype** - тип загруженного файла
- **data. size** - размер файла

#### 400
Если не указан ключ file,date или version в теле запроса, то вернется ошибка
```json
{
    "status": false,
    "message": "No file/date/version provided"
}
```

#### 401
При ошибках авторизации (не авторизован, не правильные логин или пароль)

```json
{
    "message": "Пользователь не авторизован",
    "errors": []
}
```
**message** - сообщение об ошибке авторизации
**errors** - массив ошибок, содержащий подробные сведения о всех ошибках авторизации
###

# Запрос получения информации о загруженных файлах
## GET /files/updatelist

**Параметры запроса**: отсутствуют
**Тело запроса**: отсутствует

## Ответ

### Tabs {.tabset}

#### 200
Возвращается массив, содержащий обекты json с реквизитами: filename, date, version

```json
[
    {
        "filename": "update_DB_470-EXEDLL_470.cab",
        "date": "2025-02-28T00:00:00.000Z",
        "version": "4.7.0     "
    },
    {
        "filename": "update_DB_469-EXEDLL_469.cab",
        "date": "2024-12-25T00:00:00.000Z",
        "version": "4.6.9     "
    }
]
```

- **filename** - имя файла обновления
- **date** - дата обновления
- **version** - версия обновления
###

# Запрос получения файла обновления по дате или версии
## GET /files/updatefile

**Параметры запроса**: Требуется указать любой из следующих двух параметров:
- **date** со значением даты обновления, по которому будет определена максимально доступная версия и файл обновления
- **version** со значением текущей версии. Если на сервере будут найдены более поздние версии, то будет возвращен файл новой версии

Пример: 
`GET /files/updatefile?date=2025-01-01`
или
`GET /files/updatefile?version=4.6.9`

> Наивысший приоритет у параметра **version**. Если в запросе будут указаны оба параметра, то будет обработан только параметр version.
{.is-info}


**Тело запроса**: отсутствует

## Ответ

Ответ зависит от кода ответа сервера
### Tabs {.tabset}

#### 200
В ответ будет возвращен файл обновления

В заголовке ответа вернутся:
- Filename - имя файла
- Fileversion - версия файла
- Filedate - дата обновления

![headers_f.png](/images/api/updates/headers_f.png)

#### 400
Если не указан параметр **date** или version
```json
{
    "status": false,
    "message": "No version or date provided"
}
```

#### 404
Если файл не найден по указанной дате, то вернется 404 код ответа и тело ответа:
```json
{
    "status": false,
    "message": "No update file found for this version/date"
}
```
###