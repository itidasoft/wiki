---
title: Установка Локального Модуля Честного знака в docker
description: Описание установки ЛМ ЧЗ в docker
published: true
date: 2025-03-18T14:27:18.504Z
tags: честныйзнак, docker, локальный модуль
editor: markdown
dateCreated: 2025-03-06T12:12:49.300Z
---

# Введение
Данная инструкция описывает процесс установки локального модуля системы “Честный знак” в среде Docker. Локальный модуль предназначен для работы с маркированными товарами и обеспечивает взаимодействие с национальной системой маркировки и прослеживаемости товаров в части проверок оффлайн по разрешительному режиму.

Установка производится с использованием Docker контейнеров, что обеспечивает:

- Изолированную среду выполнения
- Простоту развертывания
- Легкость масштабирования
- Воспроизводимость окружения

# Подготовка окружения
## Требования к docker
Для начала работы необходимо убедиться, что на вашем компьютере установлены:

- Docker Engine последней стабильной версии
- Docker Compose версии 2.0 или выше
- Стабильное интернет-соединение

> **Важно**: Данная инструкция предполагает, что вы уже обладаете базовыми навыками работы с Docker и умеете устанавливать программное обеспечение на вашу операционную систему.
{.is-warning}

## Требования к системе 
### Для Windows:
- Windows 10 64-bit (версия 19043 или выше)
- Windows 11 64-bit (версия 21H2 или выше)
- 64-битный процессор с поддержкой SLAT
- Минимум 4 ГБ оперативной памяти
- Включение виртуализации в BIOS
- Включение компонентов Hyper-V и Containers
### Для macOS:
- macOS 10.15 или новее
- Минимум 4 ГБ оперативной памяти
- Поддержка виртуализации Intel (EPT и Unrestricted Mode)
- Для Mac с чипом M1 требуется установка Rosetta 2
### Для Linux:
- 64-битная операционная система
- Минимум 4 ГБ оперативной памяти
- Поддержка виртуализации
- Ядро Linux версии 3.10 или выше

## Установка Docker и Docker Compose
### Установка на Linux/macOS:
Для установки Docker и Docker Compose рекомендуем следовать официальным инструкциям:

Установка Docker: https://docs.docker.com/engine/install/ 
Установка Docker Compose: https://docs.docker.com/compose/install/  

### Установка на Windows:
Для Windows рекомендуется использовать Docker Desktop, который включает в себя:

- Docker Engine
- Docker Compose
- Docker CLI
- Kubernetes (опционально)

Порядок установки Docker Desktop:

1. Скачайте установщик с официального сайта: https://www.docker.com/products/docker-desktop 
2. Запустите скачанный файл и следуйте инструкциям установщика
3. После установки запустите Docker Desktop из меню Пуск
5. При первом запуске программа предложит настроить параметры - выберите рекомендуемые настройки

### Проверка корректности установки:

```bash
# Проверка версии Docker
docker --version

# Проверка версии Docker Compose
docker compose version

# Проверка работоспособности демона
docker info
```

>**Совет**: Перед началом установки рекомендуется создать резервную копию важных данных и настроить права доступа для пользователя, от имени которого будет производиться установка.
{.is-success}


После успешной установки Docker и Docker Compose вы готовы перейти к следующему этапу - настройке и запуску локального модуля системы “Честный знак”.

> **Важно**: Данная инструкция предполагает, что вы уже обладаете базовыми навыками работы с Docker и умеете устанавливать программное обеспечение на вашу операционную систему.
{.is-warning}

# Настройка и запуск локального модуля системы Честный знак

В данном разделе будем рассматривать пример установки под управлнием операционной системы Windows 11 с установленным Docker Desktop. При необходимости данная схема аналогичным образом может быть применена и при развертывании под управлением других операционных систем (Linux и MacOS).
В примере будут развернуты два контейнера со следующими настройками:

- адрес продуктивного контура https://rsapi.crpt.ru
- имя пользователя - admin
- пароль пользователя - admin
- адрес, порт, пользователь и пароль для прокси сервера не установлены (прокси не используется)
- порт первого контейнера для связи - 5996
- порт второго контейнера для связи - 5997


При необходимости  изменения стандартных значений на свои требуется внести изменения в конфигурационный файл ext.ini, располагающийся в папке config.

![ext_ini.png](/images/imark/lmdocker/ext_ini.png){.align-center}

А изменение портов для связи 5996 и 5997 производится в файле `docker-compose.yaml`

![compose_file.png](/images/imark/lmdocker/compose_file.png){.align-center}

Так же в файле `docker-compose.yaml` можно указать используемый образ ЛМ ЧЗ в реквизите **image**. Для использования версии 1.3.0 необходимо стандартное значение заменить на 
```yml
image: registry.itida.ru/regime:1.3.0-366-ubuntu22_amd64
```
для использования самой последней версии образа можно указать вариант **latest**:
```yml
image: registry.itida.ru/regime:latest
```

Перед запуском модулей требуется [скачать архив](/images/imark/lmdocker/regime-docker.zip) с преднастроенными папками и файлом docker-compose для развертывания контейнеров и распаковать содержимое в каталог на жестком диске (например на диск D).
![docker_archive.png](/images/imark/lmdocker/docker_archive.png){.align-center}

![unpacked.png](/images/imark/lmdocker/unpacked.png){.align-center}

Далее открыть командную строку или powershell и перейти в каталог, в который распакованы папки с модулями regime1 и regime2 и файлом docker-compose.yaml.

```cmd
cd D:\regime
```

![cmd.png](/images/imark/lmdocker/cmd.png){.align-center}

Запустить команду для развертывания контейнеров `docker compose up -d` и дождаться окончания процесса развертывания.

![docker_compose.png](/images/imark/lmdocker/docker_compose.png){.align-center}

После успешного развертывания в приложении Docker Desktop отобразится информация о запущенных контейнерах.

![runing_conteiners.png](/images/imark/lmdocker/runing_conteiners.png){.align-center}

А конфигурационные файлы примут следующий вид.

![config_changed.png](/images/imark/lmdocker/config_changed.png){.align-center}

На этом процедура развертывания завершена и можно переходить к настройкам Айтида iMark для установки связи с модулями и производить инициализацию модулей: [Подключение локального модуля к Айтида iMark](/imark#подключение-локального-модуля-честного-знака)

# Обновление локального модуля в среде Docker
Для обновления ЛМ ЧЗ, развернутого в среде Docker необходимо в файле `docker-compose.yaml` изменить версию используемого образа на новую. К примеру, для обновления с версии 1.2.1-340 до версии 1.3.0-366 необходимо заменить тэг в имени используемого образа со старого значения `1.2.1-340-ubuntu22_amd64` на новое значение `1.3.0-366-ubuntu22_amd64`.

![change_imageversion.png](/images/imark/lmdocker/change_imageversion.png){.align-center}

Имена тэгов совпадают с именами образов:
![tags.png](/images/imark/lmdocker/tags.png){.align-center}

Так же допустим вариант указания тэга **latest** для обновления на самую актуальную версию образа.

![tag_latest.png](/images/imark/lmdocker/tag_latest.png){.align-center}

После изменения версии образа в файле compose необходимо в командной строке перейти в каталог, содержащий этот compose файл и выполнить следующие команды:

`docker compose pull` - для скачивания указанных в файле образов контейнеров

![pull_images2.png](/images/imark/lmdocker/pull_images2.png){.align-center}


`docker compose stop` - для остановки запущенных контейнеров

![docker_stop.png](/images/imark/lmdocker/docker_stop.png){.align-center}

`docker compose ud -d` - для запуска контейнера с использованием новых образов

![docker_up2.png](/images/imark/lmdocker/docker_up2.png){.align-center}

После запуска контейнеров необходимо произвести процедуру инициализации локальных модулей.

> Если после обновления образов инициализация локальных модулей не проходит и статус модуля отображается как "Не сконфигурирован", то рекомендуется произвести [чистую установку ЛМ ЧЗ в среде docker](/imark/lmdocker#настройка-и-запуск-локального-модуля-системы-честный-знак)
{.is-warning}
